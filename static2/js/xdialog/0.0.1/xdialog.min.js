define(function(a,b,c){var d=a("jquery"),e=a("rex"),f=a("bus"),g=a("api"),h=a("util"),i=a("store"),j=d(document.body),k=a("dialog"),l={};l.identification={options:{errors:{failed:"Password incorrect.",no_password:"Password incorrect.",no_external_id:"Set up this new identity."},onCheckUser:function(){var a=i.get("lastIdentity");a&&(this.$("#identity").val(a.external_id),this.$(".x-signin").removeClass("disabled loading"),this.availability=!0,this.$(".help-subject").addClass("icon14-clear"),this.$(".user-identity").removeClass("hide").find(".avatar").attr("src",a.avatar_filename).next().attr("class","provider icon16-identity-"+a.provider),this.$(".xbtn-forgotpwd").data("source",{identity:a})),this.availability?(this.switchTab("d01"),this.$(".help-subject").removeClass("icon14-question")):this.$(".help-subject").addClass("icon14-question")},onShowBefore:function(a){var b=d(a.currentTarget).data("source");b?this.$("#identity").val(b):this.emit("checkUser")},onShowAfter:function(){if(this.switchTabType==="d00"||this.switchTabType==="d01"||this.switchTabType==="d02"){var a=this.$("#identity");a.focusend()}},events:{"click .xbtn-verify":function(a){var b=this,c=d(a.currentTarget);if(c.hasClass("xbtn-success")){b.hide(),b.$(".verify-messages").addClass("hide"),c.removeClass("xbtn-success").text("Verify");return}var e=b._identity.provider,f=b._identity.external_id;g.request("verifyIdentity",{type:"POST",data:{provider:e,external_id:f},beforeSend:function(a){},complete:function(){}},function(a){a.action==="VERIFYING"?(b.$(".verify-messages").removeClass("hide"),c.addClass("xbtn-success").text("Done")):a.action!=="REDIRECT"},function(a){})},"blur #name":function(a){var b=h.trim(d(a.currentTarget).val()),c=this.$('[for="name"]'),e=c.find("span");b?h.utf8length(b)>30?(c.addClass("label-error"),e.text("Too long.")):h.zh_CN.test(b)?(c.addClass("label-error"),e.text("Invalid character.")):(c.removeClass("label-error"),e.text("")):(c.addClass("label-error"),e.text(""))},"blur #password":function(a){var b=h.trim(d(a.currentTarget).val()),c=this.$('[for="password"]'),e=c.find("span");b?(c.removeClass("label-error"),e.text("")):(c.addClass("label-error"),e.text("Password incorrect."))},"click .help-subject":function(a){var b=d(a.currentTarget),c=this.identityFlag;if(b.hasClass("icon14-question")){if(c&&c==="SET_PASSWORD")var e="Please sign in through authorization above. To enable password sign-in for this identity, set password from your profile page.";else var e="Identity is your online representative, such as Email, mobile #, or your account from other websites like Twitter.";b.parent().find(".xalert-error").html(e).removeClass("hide")}else this.switchTab("d00"),this.resetInputs(),this.$(".user-identity").addClass("hide"),b.toggleClass("icon14-question icon14-clear"),i.set("lastIdentity",null),i.set("last_identity",null),i.set("signin",null)},"click #password-eye":function(a){var b=d(a.currentTarget),c=b.prev();c.prop("type",function(a,b){return b==="password"?"text":"password"}),b.toggleClass("icon16-pass-hide icon16-pass-show")},"click .xbtn-forgotpwd":function(a){a.preventDefault(),this.hide()},"click .xbtn-setup":function(a){a.preventDefault(),this.$(".modal-body").eq(0).css("opacity",.2),this.switchTab("d03")},"click .xbtn-isee":function(a){a.preventDefault(),this.$(".modal-body").eq(0).css("opacity",1),this.$("#identity").val(""),this.switchTab("d02")},"click .xbtn-startover":function(a){a.preventDefault(),this.$("#identity").val(""),this.resetInputs(),this.switchTab("d00",!0)},"click .x-signin":function(a){var b=d(a.currentTarget);if(b.hasClass("disabled"))return;var c=this,e=this.switchTabType,f=this.getFormData(e);c.$("#password").trigger("blur"),e==="d02"&&c.$("#name").trigger("blur");if(!f.password||e==="d02"&&!f.name)return;if(e==="d01"||e==="d02")var h=g.request("signin",{type:"POST",data:{external_id:f.external_identity,provider:f.provider,password:f.password,name:f.name||"",auto_signin:!!f.auto_signin},beforeSend:function(a){b.addClass("disabled loading")},complete:function(a){b.removeClass("disabled loading")}},function(a){i.set("signin",a),i.set("last_identity",f.external_identity);if(e==="d01")/^\/![a-zA-z0-9]+$/.test(window.location.pathname)?window.location=window.location.pathname:window.location="/s/profile";else{c.hide();var b=new k(l.welcome);b.render(),b.show(f)}},function(a){var b=a.meta.errorType,d=a.meta.errorDetail;b==="no_password"||b==="failed"?c.$('[for="password"]').addClass("label-error").find("span").text(d||c.options.errors[b]):b==="no_external_id"&&c.$("#name").nextAll(".xalert-info").removeClass("hide")})}},backdrop:!0,viewData:{cls:"modal-id",title:"Identification",body:'<div class="shadow title">Welcome to <span class="x-sign">EXFE</span></div><div class="pull-right"><a href="http://localexfe.me/oAuth/twitterRedirect"><img src="/img/twitter-logo.png" alt="" width="52" height="40"></a></div><div class="authorize">Sign in through:</div><div class="orspliter">or</div><form class="modal-form"><fieldset><legend>Enter your identity:</legend><div class="clearfix control-group"><label class="control-label" for="identity">Identity: <span class="xalert-message"></span></label><div class="pull-right user-identity hide"><img class="avatar" src="" alt="" width="40" height="40" /><i class="provider"></i></div><div class="controls"><input type="text" class="input-large identity" id="identity" autocomplete="off" data-widget="typeahead" data-typeahead-type="identity" placeholder="Enter your email" /><i class="help-subject"></i><i class="help-inline small-loading hide"></i><div class="xalert xalert-error hide" style="margin-top: 5px;"></div></div></div><div class="form-title d d02 hide">Welcome! Please set up your new account.<span class="pull-right form-title-bd"></span></div><div class="control-group d d02 hide"><label class="control-label" for="name">Display name: <span></span></label><div class="controls"><input type="text" class="input-large" id="name" autocomplete="off" placeholder="Desired recognizable name" /></div></div><div class="control-group d d01 d02 hide"><label class="control-label" for="password">Password: <span></span></label><div class="controls"><input type="password" class="input-large" id="password" autocomplete="off" /><i class="help-inline icon16-pass-hide" id="password-eye"></i></div></div><div class="control-group d d01 hide"><div class="controls"><label class="checkbox"><input type="checkbox" id="auto-signin" value="1" checked>Sign in automatically</label></div></div><p class="verify-message hide">Verification sent, it should arrive in minutes. Please check your mailbox and follow the instruction.</p></fieldset></form>',footer:'<button href="#" class="xbtn-white d d01 xbtn-forgotpwd hide" data-dialog-from="identification" data-widget="dialog" data-dialog-type="forgotpassword">Forgot Password...</button><button href="#" class="xbtn-white d d02 d04 xbtn-startover hide">Start Over</button><button href="#" class="pull-right d d04 xbtn-blue xbtn-verify hide">Verify</button><a href="#" class="pull-right xbtn-setup d d00 hide">Set Up?</a><button href="#" class="pull-right xbtn-blue d d01 d02 x-signin disabled hide">Sign In</button><button href="#" class="pull-right xbtn-white d d03 xbtn-isee hide">I See</button>',others:'<div class="isee d d03 hide"><div class="modal-body"><div class="shadow title">Sign-Up-Free</div><p>Tired of signing up all around?</p><p>Just authorize through your existing accounts on other websites, such as Twitter, <span class="strike">Facebook or Google</span>. We hate spam, will NEVER disappoint your trust.</p><p>Otherwise, just enter your email and a recognizable  name, along with a password for sign-in in future.</p></div></div>'}}},l.sandbox={options:{onHideAfter:function(){var a=this.element;this.offSrcNode(),this.destory(),a.remove()},backdrop:!1,viewData:{cls:"mblack modal-sandbox",title:"Sandbox",body:'<div class="shadow title">“Rome wasn\'t built in a day.”</div><p><span class="x-sign">EXFE</span> [ˈɛksfi] is still in <span class="pilot">pilot</span> stage (with <span class="sandbox">SANDBOX</span> tag). We’re building up blocks of it, thus some bugs and unfinished pages. Any feedback, please email <span class="feedback">feedback@exfe.com</span>. Our apologies for any trouble you may encounter, much appreciated.</p>'}}},l.welcome={options:{events:{"click .xbtn-blue":function(a){window.location="/profile.html"}},onShowAfter:function(a){this.$(".title").eq(0).html("Hi, "+a.name+"."),a.provider==="email"?this.$(".provider-email").removeClass("hide"):this.$(".provider-other").removeClass("hide")},onHideAfter:function(){var a=this.element;this.offSrcNode(),this.destory(),a.remove()},backdrop:!0,viewData:{cls:"modal-large modal-wc",title:"Welcome",body:'<div class="shadow title"></div><div class="center shadow title" style="margin-bottom: 0;">Thanks for using <span class="x-sign">EXFE</span>.</div><p class="center">An utility for hanging out with friends.</p><p class="provider-email hide"><span class="x-sign">X</span> (cross) is a gathering of people, for any intent. When you get an idea to call up friends to do something together, just “Gather a X”.</p><p class="provider-other hide"><span class="x-sign">X</span> (cross) is a gathering of people, on purpose or not. We save you from calling up every one RSVP, losing in endless emails and messages off the point.</p><p><span class="x-sign">EXFE</span> your friends, gather a <span class="x-sign">X</span>.</p><p class="provider-email hide" style="color: #191919;"><sup>*</sup>A welcome email has been sent to your mailbox. Please check to verify your new identity.<sup>*</sup></p>',footer:'<button href="#" class="pull-right xbtn-blue">GO</button>'}}},l.forgotpassword={options:{events:{"click .xbtn-cancel":function(a){var b=this.dialog_from;this.hide();var c=this.element;this.offSrcNode(),this.destory(),c.remove(),b&&d('[data-dialog-type="'+b+'"]').trigger("click.dialog.data-api")},"click .xbtn-verify":function(a){var b=this,c=d(a.currentTarget);if(c.hasClass("disabled"))return;if(c.hasClass("success")){this.hide();var e=this.element;this.offSrcNode(),this.destory(),e.remove();return}var f=c.data("identity");f&&g.request("forgotPassword",{type:"POST",data:{provider:f.provider,external_id:f.external_id},beforeSend:function(a){c.addClass("disabled")},complete:function(a){c.removeClass("disabled")}},function(a){a.action==="VERIFYING"&&(b.$(".identity").next().removeClass("hide"),c.text("Done").addClass("success"))},function(a){})}},onShowBefore:function(a){var b=d(a.currentTarget).data("source");if(b&&b.identity){var c=b.identity;if(c){c.avatar_filename==="default.png"&&(c.avatar_filename="/img/default_portraituserface_20.png");var e=c.external_id,f=c.avatar_filename,g=this.$(".user-identity");g.find("img.avatar").attr("src",f),g.find("i").addClass("icon16-identity-"+c.provider),g.next().text(e),this.$(".xbtn-verify").data("identity",c)}}},backdrop:!1,viewData:{cls:"mblack modal-fp",title:"Forgot Password",body:'<div class="shadow title">Forgot Password</div><div>Identity to reset password:</div><div class="pull-right user-identity"><img class="avatar" src="" alt="" width="40" height="40" /><i class="provider"></i></div><div class="identity disabled"></div><div class="hide">Verification sent, it should arrive in minutes. Please check your mailbox and follow the instruction.</div><div class="xalert-error hide">Requested too much, hold on awhile. Receive no verification email? It might be mistakenly filtered as spam, please check and un-spam.</div><div class="xalert-success hide">Verification sent, it should arrive in minutes. Please check your mailbox and follow the link.</div>',footer:'<button class="pull-right xbtn-blue xbtn-verify">Verify</button><a class="pull-right xbtn-cancel">Cancel</a>'}}},l.changepassword={options:{onHideAfter:function(){var a=this.element;this.offSrcNode(),this.destory(),a.remove()},events:{"click .xbtn-resetpwd":function(a){var b=i.get("user"),c=b.identities,f=e.filter(c,function(a,b){if(a.status==="CONNECTED")return!0});if(f.length===1){a.stopPropagation(),this.hide();var g=new k(l.forgotpassword);g.dialog_from="changepassword",g.render(),d(a.currentTarget).data("identity-id",f[0].id),g.show(a)}},"click .password-eye":function(a){var b=d(a.currentTarget),c=b.prev();c.prop("type",function(a,b){return b==="password"?"text":"password"}),b.toggleClass("icon16-pass-hide icon16-pass-show")},"click .xbtn-forgotpwd":function(a){var b=i.get("user");d(a.currentTarget).data("source",{identity:b.identities[0]})},"click .xbtn-success":function(a){var b=this,c=b.$("#cppwd").val(),e=b.$("#cp-npwd").val();if(!c||!e){c?alert("Please input new password."):alert("Please input current password.");return}a.preventDefault();var f=d(a.currentTarget),h=i.get("signin"),j=h.user_id,k=h.token;g.request("setPassword",{type:"POST",resources:{user_id:j},data:{current_password:c,new_password:e},beforeSend:function(a){f.addClass("disabled loading")},complete:function(a){f.removeClass("disabled loading")}},function(a){f=b.element,b.offSrcNode(),b.destory(),f.remove()},function(a){if(a.meta.code===403){var b=a.meta.errorType;b==="invalid_current_password"&&alert("Invalid current password.")}})}},onShowBefore:function(){var a=i.get("user");this.$(".identity > img").attr("src",a.avatar_filename),this.$(".identity > span").text(a.name)},backdrop:!1,viewData:{cls:"modal-cp mblack modal-large",title:"Change Password",body:'<div class="shadow title">Change Password</div><form class="modal-form"><fieldset><legend>Please enter current password and set new one.</legend><div class="identity"><img class="avatar" src="" width="40" height="40" /><span></span></div><div class="control-group"><label class="control-label" for="cppwd">Password:</label><div class="controls"><input class="input-large" id="cppwd" placeholder="Current password" type="password" autocomplete="off" /><i class="help-inline password-eye icon16-pass-hide"></i></div></div><div class="control-group"><label class="control-label" for="cp-npwd">New Password:</label><div class="controls"><input class="input-large" id="cp-npwd" placeholder="Set new EXFE password" type="password" autocomplete="off" /><i class="help-inline password-eye icon16-pass-hide"></i></div></div></fieldset></form>',footer:'<button href="#" class="xbtn-white xbtn-resetpwd" data-dialog-from="changepassword" data-widget="dialog" data-dialog-type="resetpassword">Reset Password...</button><button class="pull-right xbtn-blue xbtn-success">Done</button><a class="pull-right xbtn-discard" data-dismiss="dialog">Discard</a>'}}},l.resetpassword={options:{onHideAfter:function(){var a=this.element;this.offSrcNode(),this.destory(),a.remove()},events:{"click .xbtn-cancel":function(a){var b=this.dialog_from;this.hide(),b&&d('[data-dialog-type="'+b+'"]').trigger("click.dialog.data-api")}},liItem:'<li><div class="pull-right user-identity"><img class="avatar" src="" width="40" height="40" /><i class="provider"></i></div><a class="identity-name" href="#"></a></li>',backdrop:!1,viewData:{cls:"modal-rsp mblack",title:"Forgot Password",footer:'<a class="pull-right xbtn-cancel">Cancel</a>',body:'<div class="shadow title">Reset Password</div><div>Reset password by verifying identity:</div><ul class="unstyled"></ul>'},onShowBefore:function(){var a=this,b=i.get("user"),c=a.options.liItem,f=b.identities,g=a.$("ul"),h={email:"email",twitter:"twitter",phone:"phone"};g.html(""),e.each(f,function(a,b){if(a.status==="CONNECTED"){var e=d(c);e.find("a").text(a.provider==="twitter"?a.name:a.external_id),e.find("a").attr("data-dialog-from","resetpassword"),e.find("a").attr("data-dialog-type","verification_"+a.provider),e.find("a").attr("data-widget","dialog"),e.find("a").attr("data-identity-id",a.id),e.find("img").attr("src",a.avatar_filename),e.find("i").addClass("icon16-identity-"+h[a.provider]),g.append(e)}})}}},l.addidentity={options:{backdrop:!0,events:{"click .xbtn-forgotpwd":function(a){var b=h.trim(this.$("#new-identity").val())},"click .xbtn-success":function(a){var b=h.trim(this.$("#new-identity").val()),c=this.$("#password").val();if(!b||!c){b?alert("Identity password empty."):alert("Identity empty.");return}var e=d(a.currentTarget),j=i.get("signin"),k=j.user_id,l=j.token,m=this,n=h.parseId(b);n.provider&&g.request("addIdentity",{type:"POST",data:{external_id:n.external_identity,provider:n.provider,password:c},beforeSend:function(a){e.addClass("disabled loading")},complete:function(a){e.removeClass("disabled loading")}},function(a){m.hide(),f.emit("app:addidentity",a)})}},onShowBefore:function(){this.element.removeClass("hide"),this.$("#new-identity").focusend()},onHideAfter:function(){var a=this.element;this.offSrcNode(),this.destory(),a.remove()},viewData:{cls:"modal-id",title:"Identification",body:'<div class="shadow title">Welcome to <span class="x-sign">EXFE</span></div><div class="pull-right"><a href="#twitter"><img src="/img/twitter-logo.png" alt="" width="52" height="40"></a></div><div class="authorize">Authorize account through:</div><div class="orspliter">or</div><form class="modal-form"><fieldset><legend>Enter your identity information:</legend><div class="control-group"><label class="control-label" for="new-identity">Identity:</label><div class="controls /*identity-avatar*/"><img class="add-on avatar hide" src="" alt="" width="20" height="20" /><input type="text" class="input-large identity" id="new-identity" autocomplete="off" data-widget="typeahead" data-typeahead-type="identity" /><i class="help-inline small-loading hide"></i><div class="xalert-info hide">Set up this new identity.</div></div></div><div class="control-group"><label class="control-label" for="password">Password:</label><div class="controls"><input type="password" class="input-large" id="password" /><input type="text" class="input-large hide" autocomplete="off" /><i class="help-inline icon16-pass-hide" id="password-eye"></i><div class="xalert-error hide"></div></div></div></fieldset></form>',footer:'<button href="#" class="xbtn-white xbtn-forgotpwd" data-dialog-from="identification" data-widget="dialog" data-dialog-type="forgotpassword">Forgot Password...</button><button href="#" class="pull-right xbtn-blue xbtn-success disabled">Add</button>'}},availability:!1,init:function(){var a=this;f.on("widget-dialog-identification-auto",function(b){a.availability=!1,b?(b.registration_flag==="SIGN_IN"?(a.$(".xalert-info").removeClass("hide"),a.$(".xbtn-forgotpwd").removeClass("hide").data("source",b)):b.registration_flag==="SIGN_UP"&&(a.availability=!0,a.$(".xbtn-forgotpwd").addClass("hide").data("source",null)),a.$(".xbtn-success").removeClass("disabled")):(a.$(".xbtn-success").addClass("disabled"),a.$(".xbtn-forgotpwd").addClass("hide").data("source",null))}),f.on("widget-dialog-identification-nothing",function(){a.$(".xbtn-forgotpwd").addClass("hide")})}},l.verification_email={options:{onHideAfter:function(){var a=this.element;this.offSrcNode(),this.destory(),a.remove()},events:{"click .xbtn-verify":function(a){var b=d(a.currentTarget);if(b.hasClass("disabled")||b.hasClass("success")){b.hasClass("success")&&this.hide();return}var c=this,e=b.data("identity_id");g.request("verifyUserIdentity",{type:"POST",data:{identity_id:e},beforeSend:function(a){b.addClass("disabled")},complete:function(){b.removeClass("disabled")}},function(a){a.action==="VERIFYING"&&b.text("Done").addClass("success")},function(a){})},"click .xbtn-cancel":function(a){var b=this.dialog_from;this.hide(),b&&(d('[data-dialog-type="'+b+'"]').trigger("click.dialog.data-api"),d("#identity").focusend())}},backdrop:!1,viewData:{cls:"mblack modal-ve",title:"Verification",body:'<div class="shadow title">Identity Verification</div><div>Identity to verify:</div><div class="pull-right user-identity"><img class="avatar" src="" alt="" width="40" height="40"><i class="provider icon16-identity-email"></i></div><div class="identity disabled"></div><p>Confirm sending verification to your mailbox?</p><p class="hide">Requested too much, hold on awhile. Receive no verification email? It might be mistakenly filtered as spam. Or try ‘Manual Verification’.</p>',footer:'<button class="pull-right xbtn-blue xbtn-verify">Verify</button><a class="pull-right xbtn-cancel">Cancel</a>'},onShowBefore:function(a){var b=d(a.currentTarget),c=b.parents("li").data("identity-id"),f=i.get("user"),g=e.filter(f.identities,function(a,b){if(a.id===c)return!0})[0];this.$(".xbtn-verify").data("identity_id",g.id),this.$(".identity").text(g.external_id),this.$(".avatar").attr("src",g.avatar_filename)}}},l.verification_twitter={options:{events:{"click .xbtn-verify":function(a){var b=d(a.currentTarget),c=this;if(b.hasClass("disabled")||b.hasClass("success")){b.hasClass("success")&&this.hide();return}var e=b.data("identity_id");g.request("verifyUserIdentity",{type:"POST",data:{identity_id:e},beforeSend:function(a){b.addClass("disabled")},complete:function(){b.removeClass("disabled")}},function(a){a.action==="VERIFYING"&&b.text("Done").addClass("success")},function(a){})},"click .xbtn-cancel":function(a){var b=this.element;this.offSrcNode(),this.destory(),b.remove()}},backdrop:!1,viewData:{cls:"mblack modal-ve",title:"Verification",body:'<div class="shadow title">Identity Verification</div><div>Identity to verify:</div><div class="pull-right user-identity"><img class="avatar" src="" alt="" width="40" height="40"><i class="provider icon16-identity-twitter"></i></div><div class="identity disabled"></div><p>You will be directed to Twitter website to authorize <span class="x-sign">EXFE</span>. Don’t forget to follow @<span class="">EXFE</span>, it’s necessary for smooth service integration.</p><p>We hate spam, will NEVER disappoint your trust.</p>',footer:'<button class="pull-right xbtn-blue xbtn-verify">Verify</button><a class="pull-right xbtn-cancel">Cancel</a>'},onShowBefore:function(a){var b=d(a.currentTarget),c=b.parents("li").data("identity-id"),f=i.get("user"),g=e.filter(f.identities,function(a,b){if(a.id===c)return!0})[0];this.$(".xbtn-verify").data("identity_id",g.id),this.$(".identity").text(g.external_id),this.$(".avatar").attr("src",g.avatar_filename)}}},l.verification_phone={options:{events:{},backdrop:!1,viewData:{cls:"mblack modal-ve",title:"Verification",body:'<div class="shadow title">Identity Verification</div><div>Identity to verify:</div>'}}},l.setpassword={options:{backdrop:!1,viewData:{cls:"mblack modal-sp",title:"Set Password",body:'<div class="shadow title">Set Password</div><form class="modal-form form-horizontal"><fieldset><legend>Please set a universal password for your account. You can sign in by any of your identities (if more than one), with the same password.</legend><div class="control-group"><label class="control-label" for="setpassword">Password:</label><div class="controls"><input type="password" class="input-large" id="setpassword" /><input type="text" class="input-large hide" autocomplete="off" id="setpassword-text" /><div class="xalert-error hide"></div></div></div></fieldset></form><p>e.g.: To sign in with your Twitter account. Just use “@myTwitterID@Twitter” as your identity, along with your password above.</p>',footer:'<button href="#" class="pull-right xbtn-blue xbtn-success">Done</button>'}}};var m=k.extend({availability:!1,init:function(){var a=this;f.on("widget-dialog-identification-auto",function(b){var c=a.$('[for="identity"]'),d=c.find("span");a.availability=!1,a.identityFlag=null;var e;a.switchTabType==="d24"&&(e="d01"),b?(c.removeClass("label-error"),d.text(""),a.$(".help-subject").removeClass("icon14-question").addClass("icon14-clear").parent().find(".xalert-error").addClass("hide"),b.identity?(a._identity=b.identity,a.$(".user-identity").removeClass("hide").find(".avatar").attr("src",b.identity.avatar_filename).next().attr("class","provider icon16-identity-"+b.identity.provider)):(a._identity=null,a.$(".user-identity").addClass("hide")),a.identityFlag=b.registration_flag,b.registration_flag==="SIGN_IN"?e="d01":b.registration_flag==="SIGN_UP"?e="d02":b.registration_flag==="SET_PASSWORD"?(e="d00",c.addClass("label-error"),d.text("Identity has no password set.")):b.registration_flag==="VERIFY"&&(e="d04"),a.availability=!0):(a.$(".help-subject").removeClass("icon14-clear").addClass("icon14-question"),c.addClass("label-error"),d.text("Invalid identity.")),e&&a.switchTabType!==e&&a.switchTab(e),a.$(".x-signin")[(a.availability?"remove":"add")+"Class"]("disabled"),a.$(".xbtn-forgotpwd").data("source",b)}),f.on("widget-dialog-identification-nothing",function(){a.$(".user-identity").addClass("hide"),a.$('[for="identity"]').removeClass("label-error").find("span").text(""),a.$(".xbtn-forgotpwd").data("source",null),a.availability=!1,a.$(".x-signin")[(a.availability?"remove":"add")+"Class"]("disabled")})},resetInputs:function(){this.$("input").val(""),this.$(".label-error").removeClass("label-error").find("span").text(""),this.$(".icon16-pass-show").toggleClass("icon16-pass-show icon16-pass-hide").prev().prop("type","password"),this.$("#identity").focusend()},setPasswordPlaceHolder:function(a){a==="d02"?this.$("#password").attr("placeholder","Set your EXFE Password"):a==="d01"&&this.$("#password").attr("placeholder","Your EXFE Password")},getFormData:function(a){var b=h.trim(this.$("#identity").val()),c=h.parseId(b);if(a==="d01"||a==="d02")c.password=this.$("#password").val();return a==="d01"&&(c.auto_signin=this.$("#auto-signin").prop("checked")),a==="d02"&&(c.name=h.trim(this.$("#name").val())),c},switchTab:function(a,b){this.$(".d").not(".hide").addClass("hide").end().filter("."+a).removeClass("hide"),this.$(".x-signin")[(this.availability?"remove":"add")+"Class"]("disabled"),this.$(".xalert-error").addClass("hide"),this.switchTabType=a;if(this.isShown&&(this.switchTabType==="d00"||this.switchTabType==="d01"||this.switchTabType==="d02")){var c=this.$("#identity");c.focusend()}this.setPasswordPlaceHolder(a)}});d(function(){j.on("click.dialog.data-api",'[data-widget="dialog"]',function(a){var b=d(this),c=b.data("dialog"),e,f=b.data("dialog-type"),g=b.data("dialog-tab"),h=b.data("dialog-from"),i=b.data("source");a.preventDefault(),c||f&&(e=l[f],c=new(f==="identification"?m:k)(e),c.options.srcNode=b,h&&(c.dialog_from=h),c.render(),b.data("dialog",c)),g&&c.switchTab(g),c.show(a)})})});