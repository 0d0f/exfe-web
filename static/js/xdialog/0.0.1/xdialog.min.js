define("xdialog",function(e,t,n){var r=e("jquery"),i=e("rex"),s=e("bus"),o=e("api"),u=e("util"),a=e("store"),f=r(document.body),l=e("dialog"),c={};t.dialogs=c,c.identification={options:{errors:{failed:"Password incorrect.",no_password:"Password incorrect.",no_external_id:"Set up this new identity."},onCheckUser:function(){var e=a.get("lastIdentity"),t=a.get("last_external_username");e&&(this.availability=!0,this.$("#identity").val(t),this.$(".x-signin").removeClass("disabled loading"),this.$(".user-identity").removeClass("hide").find(".avatar").attr("src",e.avatar_filename).next().attr("class","provider icon16-identity-"+e.provider),this.$(".xbtn-forgotpwd").data("source",[e]),this.switchTab("d01")),this.$(".help-subject").toggleClass("icon14-question",!this.availability)},onShowBefore:function(e){var t=r(e.currentTarget).data("source");t?this.$("#identity").val(t):this.emit("checkUser")},onShowAfter:function(){(this.switchTabType==="d00"||this.switchTabType==="d01"||this.switchTabType==="d02")&&this.$("#identity").focusend()},onHideAfter:function(){this.$(".modal-body").eq(0).css("opacity",1),this.switchTabType="d00",this._oauth_&&this._oauth_.abort();var e=this.element;this.offSrcNode(),this.destory(),e.remove(),r(".popmenu").remove()},events:{"keypress .modal-main":function(e){var t=this.switchTabType,n=e.keyCode;this.availability&&(t==="d01"||t==="d02")&&n===13&&this.$(".x-signin").click()},"click .oauth > a":function(e){e.stopPropagation(),e.preventDefault();var t=this,n=r(e.currentTarget),i=n.data("oauth");i==="twitter"&&(t._oauth_=r.ajax({url:"/OAuth/twitterAuthenticate",dataType:"JSON",beforeSend:function(e){t.$(".modal-body").eq(0).css("opacity",0),t.switchTab("d05"),t.$(".authentication").find("img").removeClass("hide"),t.$(".authentication").find(".redirecting").removeClass("hide"),t.$(".authentication").find(".xalert-fail").addClass("hide"),t.$(".xbtn-oauth").addClass("hide")},success:function(e){var n=e.meta.code;n===200?window.location.href=e.response.redirect:(t.$(".authentication").find("img").addClass("hide"),t.$(".authentication").find(".redirecting").addClass("hide"),t.$(".authentication").find(".xalert-fail").removeClass("hide"),t.$(".xbtn-oauth").removeClass("hide"))}}))},"click .xbtn-oauth":function(e){return this.$(".modal-body").eq(0).css("opacity",1),this.switchTab("d00"),!1},"click .xbtn-verify":function(e){var t=this,n=r(e.currentTarget);if(n.hasClass("xbtn-success"))return t.$(".verify-after").addClass("hide"),n.removeClass("xbtn-success").text("Verify"),t.hide(),!1;var i=t._identity.provider,s=t._identity.external_id;o.request("verifyIdentity",{type:"POST",data:{provider:i,external_username:s}},function(e){t.$(".verify-before").addClass("hide"),e.action==="VERIFYING"?(t.$(".verify-after").removeClass("hide"),n.addClass("xbtn-success").text("Done")):e.action!=="REDIRECT"&&n.addClass("verify-error").removeClass("hide")})},"blur #identity":function(e){var t=u.trim(r(e.currentTarget).val()),n=this.$('[for="identity"]'),i=n.find("span");t.length&&!u.parseId(t).provider?(n.addClass("label-error"),i.text("Invalid identity.")):(n.removeClass("label-error"),i.text(""))},"blur #name":function(e){var t=u.trim(r(e.currentTarget).val()),n=this.$('[for="name"]'),i=n.find("span");t?u.utf8length(t)>30?(i.text("Too long."),n.addClass("label-error")):u.zh_CN.test(t)?(n.addClass("label-error"),i.text("Invalid character.")):(n.removeClass("label-error"),i.text("")):(n.addClass("label-error"),i.text(""))},"blur #password":function(e){var t=u.trim(r(e.currentTarget).val()),n=this.$('[for="password"]'),i=n.find("span");t?(n.removeClass("label-error"),i.text("")):(n.addClass("label-error"),i.text("Password incorrect."))},"click .help-subject":function(e){var t=r(e.currentTarget),n=this.identityFlag,i;t.hasClass("icon14-question")?(i='Identity is your online representative, such as email, <span class="strike">mobile no.</span>, and your account username on other websites like Twitter, Facebook, etc.',t.parent().find(".xalert-error:eq(0)").html(i).removeClass("hide")):(t.toggleClass("icon14-question icon14-clear"),this.resetInputs(),this.$(".user-identity").addClass("hide"),a.remove("lastIdentity"),a.remove("last_external_username"),a.remove("authorization"),a.remove("user"),a.remove("identities"),this.$('[data-typeahead-type="identity"]').data("typeahead").source=null,this.switchTab("d00"))},"click #password-eye":function(e){var t=r(e.currentTarget),n=t.prev();n.prop("type",function(e,t){return t==="password"?"text":"password"}),t.toggleClass("icon16-pass-hide icon16-pass-show")},"click .xbtn-forgotpwd":function(e){e.preventDefault(),this.element.addClass("hide"),r("#js-modal-backdrop").addClass("hide")},"click .xbtn-setup":function(e){e.preventDefault(),this.$(".modal-body").eq(0).css("opacity",.05),this.switchTab("d03")},"click .xbtn-isee":function(e){e.preventDefault(),this.$(".modal-body").eq(0).css("opacity",1),this.$("#identity").val(""),this.switchTab("d02")},"click .xbtn-startover":function(e){e.preventDefault(),this.$("#identity").val(""),this.resetInputs(),this.switchTab("d00",!0)},"click .x-signin":function(e){var t=r(e.currentTarget);if(t.hasClass("disabled"))return;var n=this,i=this.switchTabType,u=this.getFormData(i);n.$("#password").trigger("blur"),i==="d02"&&n.$("#name").trigger("blur");if(!u.password||i==="d02"&&!u.name)return;u.provider!=="email"&&(u.external_identity=u.external_username),(i==="d01"||i==="d02")&&o.request("signin",{type:"POST",data:{external_username:u.external_identity,provider:u.provider,password:u.password,name:u.name||"",auto_signin:!!u.auto_signin},beforeSend:function(e){t.addClass("disabled loading")},complete:function(e){t.removeClass("disabled loading")}},function(e){a.set("authorization",e),a.set("last_external_username",u.external_identity),n.hide();if(i==="d01"||i==="d02")s.emit("app:user:signin",e.token,e.user_id),s.emit("xapp:usersignin");else{var t=new l(c.welcome);t.render(),t.show({identity:{name:u.name,provider:u.provider}})}},function(e){var t=e.meta.errorType,r=e.meta.errorDetail;t==="no_password"||t==="failed"?n.$('[for="password"]').addClass("label-error").find("span").text(r||n.options.errors[t]):t==="no_external_id"&&n.$("#name").nextAll(".xalert-info").removeClass("hide")})}},backdrop:!0,viewData:{cls:"modal-id",title:"Start",body:'<div class="shadow title">Welcome to <span class="x-sign">EXFE</span></div><div class="clearfix"><div class="pull-left authorize">Authenticate with:</div><div class="pull-left oauth"><a href="#" class="oauth-twitter" data-oauth="twitter">twitter</a></div></div><div class="orspliter">or</div><form class="modal-form"><fieldset><legend>Use your online identity:</legend><div class="clearfix control-group"><label class="control-label" for="identity">Identity: <span class="xalert-message"></span></label><div class="pull-right user-identity hide"><img class="avatar" src="" alt="" width="40" height="40" /><i class="provider"></i></div><div class="controls"><input type="text" class="input-large identity" id="identity" autocomplete="off" data-widget="typeahead" data-typeahead-type="identity" placeholder="Enter your email" /><i class="help-subject"></i><i class="help-inline small-loading hide"></i><div class="xalert xalert-error hide" style="margin-top: 5px;"></div><div class="xalert xalert-error authenticate hide" style="margin-top: 5px;"><span class="xalert-fail">Please directly authenticate identity above.</span><br />To enable password sign-in for this identity, set an <span class="x-sign">EXFE</span> password first in your profile page.</div></div></div><div class="form-title d d02 hide">Welcome! Please set up your new account.<span class="pull-right form-title-bd"></span></div><div class="control-group d d02 hide"><label class="control-label" for="name">Display name: <span></span></label><div class="controls"><input type="text" class="input-large" id="name" autocomplete="off" placeholder="Desired recognizable name" /></div></div><div class="control-group d d01 d02 hide"><label class="control-label" for="password">Password: <span></span></label><div class="controls"><input type="password" class="input-large" id="password" autocomplete="off" /><i class="help-inline icon16-pass-hide pointer" id="password-eye"></i></div></div><div class="control-group d d01 hide"><div class="control-label"><label class="checkbox pointer"><input type="checkbox" id="auto-signin" value="1" checked />Sign in automatically</label></div></div><div class="verify-before d d04 hide"><span class="xalert-fail">This identity requires verification before using.</span><br />Confirm sending verification to your mailbox?</div><div class="verify-after hide">Verification sent, it should arrive in minutes. Please check your mailbox and follow the instruction.</div><div class="verify-error hide"><span class="xalert-fail">Requested too much, hold on awhile.</span><br />Receive no verification email? It might be mistakenly filtered as spam, please check and un-spam. Alternatively, use ‘Manual Verification’.</div></fieldset></form>',footer:'<button class="xbtn-white d d01 xbtn-forgotpwd hide" data-dialog-from="identification" data-widget="dialog" data-dialog-type="forgotpassword">Forgot Password...</button><button class="xbtn-white d d02 d04 xbtn-startover hide">Start Over</button><button class="pull-right d d04 xbtn-blue xbtn-verify hide">Verify</button><a href="#" class="pull-right xbtn-setup d d00 hide">Looking for sign-up?</a><button class="pull-right xbtn-blue d d01 d02 x-signin disabled hide">Start</button><button class="pull-right xbtn-white d d03 xbtn-isee hide">I See</button><button class="pull-right xbtn-white d hide">OK</button><button class="pull-right xbtn-white d xbtn-oauth hide">Back</button>',others:'<div class="isee d d03 hide"><div class="modal-body"><div class="shadow title">“Sign-Up-Free”</div><p>Tired of signing up all around? Just authorize through your existing accounts from other websites, such as Twitter, <span class="strike">Facebook, Google, etc.</span> (soon to support)</p><p>We hate spam, will NEVER disappoint your trust.</p><p>Alternatively, traditional registration process with email and password is also available.</p></div></div><div class="authentication d d05 hide"><div class="modal-body"><div class="shadow title">Authentication</div><div class="content"><img class="hide" src="/static/img/loading.gif" width="32" height="32" /><p class="redirecting hide">Redirecting to Twitter…</p><p class="xalert-fail hide">Failed to connect with Twitter server.</p></div></div></div>'}}},c.sandbox={options:{onHideAfter:function(){var e=this.element;this.offSrcNode(),this.destory(),e.remove()},backdrop:!1,viewData:{cls:"mblack modal-sandbox",title:"Sandbox",body:'<div class="shadow title">“Rome wasn\'t built in a day.”</div><p><span class="x-sign">EXFE</span> [ˈɛksfi] is still in <span class="pilot">pilot</span> stage (with <span class="sandbox">SANDBOX</span> tag). We’re building up blocks, consequently some bugs or unfinished pages may happen. Our apologies for any trouble you may encounter. Any feedback, please email <span class="feedback">feedback@exfe.com</span>. Much appreciated.</p>'}}},c.welcome={options:{events:{"click .xbtn-go":function(e){var t=this;if(this._provider==="email"){if(/^\/![a-zA-z0-9]+$/.test(window.location.pathname)){window.location=window.location.pathname;return}}else this.$("#follow").prop("checked")&&this._token&&r.ajax({url:"/OAuth/followExfe?token="+this._token,type:"POST",data:{identity_id:this._identity_id}});t.hide()},"click .why":function(e){this.$(".answer").toggleClass("hidden")}},onShowBefore:function(e){var t=e.identity,n=this.$(".title").eq(0);this._provider=t.provider,this._identity_id=t.id,this._token=e.token,t.provider==="email"?(this.$(".provider-email").removeClass("hide"),n.text("Hi, "+t.name+".")):(this.$(".provider-other").removeClass("hide"),n.text("Hi, "+u.printExtUserName(t)+"."))},onHideAfter:function(){var e=this.element;this.offSrcNode(),this.destory(),e.remove()},backdrop:!1,viewData:{cls:"mblack modal-large modal-wc",title:"Welcome",body:'<div class="shadow title"></div><div class="center shadow title" style="margin-bottom: 0;">Thanks for using <span class="x-sign">EXFE</span>.</div><p class="center">A utility for hanging out with friends.</p><div class="modal-content"><p>We save you from calling up every one RSVP, losing in endless emails and messages off the point.</p><p><span class="x">·X·</span> (cross) is a gathering of people, for any intent. When you get an idea to call up friends to do something together, just “Gather a <span class="x">·X·</span>.</p><p><span class="x-sign">EXFE</span> your friends.</p><p class="provider-email hide" style="color: #191919;">*A welcome email has been sent to your mailbox. Please check to verify your address.*</p><div class="provider-other hide">&nbsp;&nbsp;<span class="underline why">why?</span><label class="pull-left checkbox pointer"><input type="checkbox" id="follow" value="1" checked />Follow @<span class="x-sign">EXFE</span> on Twitter.</label><p class="pull-left answer hidden">So we could send you invitation PRIVATELY through Direct Message. We hate spam, will NEVER disappoint your trust.</p></div></div>',footer:'<button class="pull-right xbtn-white xbtn-go">GO</button>'}}},c.forgotpassword={updateIdentity:function(e){var t=e.avatar_filename,n=this.$(".user-identity");n.find("img.avatar").attr("src",e.avatar_filename),n.find("i").addClass("icon16-identity-"+e.provider),n.next().find(".identity").text(e.eun),this.$(".xbtn-send").data("identity",e)},options:{onHideAfter:function(e){if(e){var t=this.dialog_from;t&&r('[data-dialog-type="'+t+'"]').data("dialog").hide()}var n=this.element;this.offSrcNode(),this.destory(),n.remove()},events:{"click .caret-outer":function(e){this.$(".dropdown-toggle").addClass("open"),e.stopPropagation()},"hover .dropdown-menu > li":function(e){var t=e.type,n=r(e.currentTarget);n[(t==="mouseenter"?"add":"remove")+"Class"]("active")},"click .dropdown-menu > li":function(e){var t=this.$(".dropdown-menu").data("identities"),n=r(e.currentTarget).data("index");this.updateIdentity(t[n])},"click .xbtn-cancel":function(e){var t=this.dialog_from;this.hide(),t&&(r('[data-dialog-type="'+t+'"]').data("dialog").element.removeClass("hide"),r("#js-modal-backdrop").removeClass("hide"))},"click .xbtn-send":function(e){var t=this,n=r(e.currentTarget);if(n.hasClass("disabled"))return;if(n.hasClass("success")){this.hide(e);var i=this.element;return}var s=n.data("identity");s&&o.request("forgotPassword",{type:"POST",data:{provider:s.provider,external_username:s.external_username},beforeSend:function(e){t.$(".send-before").removeClass("hide"),t.$(".send-after").addClass("hide"),n.addClass("disabled")},complete:function(e){n.removeClass("disabled")}},function(e){e.action==="VERIFYING"&&(t.$(".identity").next().removeClass("hide"),n.text("Done").addClass("success"),t.$(".send-before").addClass("hide"),t.$(".send-after").removeClass("hide"))})}},onShowBefore:function(e){var t=this,n=r(e.currentTarget).data("source"),i,s;if(n&&(i=n.length)){s=n[0];var o=s.external_username;s.provider==="twitter"&&(o="@"+s.external_username),s.eun=o;if(i>1){t.$(".caret-outer").removeClass("hide");var u="";for(var a=0;a<i;a++){var o=n[a].external_username;u+='<li data-index="'+a+'"><i class="pull-right icon16-identity-'+n[a].provider+'"></i>',n[a].provider==="twitter"&&(o="@"+n[a].external_username),n[a].eun=o,u+="<span>"+o+"</span>",u+="</li>"}t.$(".dropdown-menu").html(u).data("identities",n)}this.updateIdentity(s)}},backdrop:!1,viewData:{cls:"mblack modal-fp",title:"Forgot Password",body:'<div class="shadow title">Forgot Password</div><div>You can reset your <span class="x-sign">EXFE</span> password through identity:</div><div class="pull-right user-identity"><img class="avatar" src="" alt="" width="40" height="40" /><i class="provider"></i></div><div class="clearfix dropdown-toggle" data-toggle="dropdown"><div class="pull-left identity disabled"></div><ul class="dropdown-menu"></ul><div class="pull-left caret-outer hide"><b class="caret"></b></div></div><div class="send-before">Confirm sending reset token to your mailbox?</div><div class="send-after hide">Verification sent, it should arrive in minutes. Please check your mailbox and follow the instruction.</div><div class="xalert-error hide"><p>Requested too much, hold on awhile.</p><p>Receive no verification email? It might be mistakenly filtered as spam, please check and un-spam. Alternatively, use ‘Manual Verification’.</p></div>',footer:'<button class="pull-right xbtn-blue xbtn-send">Send</button><a class="pull-right xbtn-cancel">Cancel</a>'}}},c.changepassword={options:{onHideAfter:function(){var e=this.element;this.offSrcNode(),this.destory(),e.remove()},events:{"click .xbtn-resetpwd":function(e){var t=a.get("user"),n=t.identities,s=i.filter(n,function(e,t){if(e.status==="CONNECTED")return!0});if(s.length===1){e.stopPropagation(),this.hide();var o=new l(c.forgotpassword);o.dialog_from="changepassword",o.render(),r(e.currentTarget).data("identity-id",s[0].id),o.show(e)}},"click .password-eye":function(e){var t=r(e.currentTarget),n=t.prev();n.prop("type",function(e,t){return t==="password"?"text":"password"}),t.toggleClass("icon16-pass-hide icon16-pass-show")},"click .xbtn-forgotpwd":function(e){var t=a.get("user"),n=t.identities,s=[];i.each(n,function(e,t){e.status==="CONNECTED"&&s.push(e)}),0===s.length&&s.push(t.default_identity),r(e.currentTarget).data("source",s)},"click .xbtn-success":function(e){var t=this,n=t.$("#cppwd").val(),i=t.$("#cp-npwd").val();if(!n||!i){n?alert("Please input new password."):alert("Please input current password.");return}e.preventDefault();var s=r(e.currentTarget),u=a.get("authorization"),f=u.user_id,l=u.token;o.request("setPassword",{type:"POST",params:{token:l},resources:{user_id:f},data:{current_password:n,new_password:i},beforeSend:function(e){s.addClass("disabled loading")},complete:function(e){s.removeClass("disabled loading")}},function(e){s=t.element,t.offSrcNode(),t.destory(),s.remove()},function(e){if(e.meta.code===403){var t=e.meta.errorType;t==="invalid_current_password"&&alert("Invalid current password.")}})}},onShowBefore:function(){var e=a.get("user");this.$(".identity > img").attr("src",e.avatar_filename),this.$(".identity > span").text(e.name)},backdrop:!1,viewData:{cls:"modal-cp mblack modal-large",title:"Change Password",body:'<div class="shadow title">Change Password</div><form class="modal-form"><fieldset><legend>Enter your current <span class="x-sign">EXFE</span> password, and set new one. All your identities share the same password for sign-in and account management.</legend><div class="identity"><img class="avatar" src="" width="40" height="40" /><span></span></div><div class="control-group"><label class="control-label" for="cppwd">Password:</label><div class="controls"><input class="input-large" id="cppwd" placeholder="Current password" type="password" autocomplete="off" /><i class="help-inline password-eye icon16-pass-hide pointer"></i></div></div><div class="control-group"><label class="control-label" for="cp-npwd">New Password:</label><div class="controls"><input class="input-large" id="cp-npwd" placeholder="Set new EXFE password" type="password" autocomplete="off" /><i class="help-inline password-eye icon16-pass-hide pointer"></i></div></div></fieldset></form>',footer:'<button class="xbtn-white xbtn-forgotpwd" data-dialog-from="changepassword" data-widget="dialog" data-dialog-type="forgotpassword">Forgot Password...</button><button class="pull-right xbtn-blue xbtn-success">Change</button><a class="pull-right xbtn-discard" data-dismiss="dialog">Discard</a>'}}},c.addidentity={options:{backdrop:!0,events:{"click .xbtn-forgotpwd":function(e){var t=u.trim(this.$("#new-identity").val())},"click .xbtn-success":function(e){var t=u.trim(this.$("#new-identity").val()),n=this.$("#password").val();if(!t||!n){t?alert("Identity password empty."):alert("Identity empty.");return}var i=r(e.currentTarget),f=a.get("authorization"),l=f.user_id,c=f.token,h=this,p=u.parseId(t);p.provider&&o.request("addIdentity",{type:"POST",params:{token:c},data:{external_id:p.external_identity,provider:p.provider,password:n},beforeSend:function(e){i.addClass("disabled loading")},complete:function(e){i.removeClass("disabled loading")}},function(e){h.hide(),s.emit("app:addidentity",e)})}},onShowBefore:function(){this.element.removeClass("hide"),this.$("#new-identity").focusend()},onHideAfter:function(){var e=this.element;this.offSrcNode(),this.destory(),e.remove()},viewData:{cls:"modal-id",title:"Identification",body:'<div class="shadow title">Welcome to <span class="x-sign">EXFE</span></div><div class="pull-right"><a href="#twitter"><img src="/img/twitter-logo.png" alt="" width="52" height="40"></a></div><div class="authorize">Authorize account through:</div><div class="orspliter">or</div><form class="modal-form"><fieldset><legend>Enter your identity information:</legend><div class="control-group"><label class="control-label" for="new-identity">Identity:</label><div class="controls /*identity-avatar*/"><img class="add-on avatar hide" src="" alt="" width="20" height="20" /><input type="text" class="input-large identity" id="new-identity" autocomplete="off" data-widget="typeahead" data-typeahead-type="identity" /><i class="help-inline small-loading hide"></i><div class="xalert-info hide">Set up this new identity.</div></div></div><div class="control-group"><label class="control-label" for="password">Password:</label><div class="controls"><input type="password" class="input-large" id="password" /><input type="text" class="input-large hide" autocomplete="off" /><i class="help-inline icon16-pass-hide pointer" id="password-eye"></i><div class="xalert-error hide"></div></div></div></fieldset></form>',footer:'<button class="xbtn-white xbtn-forgotpwd" data-dialog-from="identification" data-widget="dialog" data-dialog-type="forgotpassword">Forgot Password...</button><button class="pull-right xbtn-blue xbtn-success disabled">Add</button>'}},availability:!1,init:function(){var e=this;s.on("widget-dialog-identification-auto",function(t){e.availability=!1,t?(t.registration_flag==="SIGN_IN"?(e.$(".xalert-info").removeClass("hide"),e.$(".xbtn-forgotpwd").removeClass("hide").data("source",[t.identity])):t.registration_flag==="SIGN_UP"&&(e.availability=!0,e.$(".xbtn-forgotpwd").addClass("hide").data("source",null)),e.$(".xbtn-success").removeClass("disabled")):(e.$(".xbtn-success").addClass("disabled"),e.$(".xbtn-forgotpwd").addClass("hide").data("source",null))}),s.on("widget-dialog-identification-nothing",function(){e.$(".xbtn-forgotpwd").addClass("hide")})}},c.verification_email={options:{onHideAfter:function(){var e=this.element;this.offSrcNode(),this.destory(),e.remove()},events:{"click .xbtn-verify":function(e){var t=r(e.currentTarget);if(t.hasClass("disabled")||t.hasClass("success")){t.hasClass("success")&&this.hide();return}var n=this,i=t.data("identity_id"),s=a.get("authorization"),u=s.token;o.request("verifyUserIdentity",{type:"POST",params:{token:u},data:{identity_id:i},beforeSend:function(e){t.addClass("disabled")},complete:function(){t.removeClass("disabled")}},function(e){n.$(".verify-before").addClass("hide"),e.action==="VERIFYING"?(n.$(".verify-after").removeClass("hide"),t.text("Done").addClass("success")):n.$(".xalert-error").removeClass("hide")})},"click .xbtn-cancel":function(e){var t=this.dialog_from;this.hide(),t&&(r('[data-dialog-type="'+t+'"]').trigger("click.dialog.data-api"),r("#identity").focusend())}},backdrop:!1,viewData:{cls:"mblack modal-ve",title:"Verification",body:'<div class="shadow title">Identity Verification</div><div>Identity to verify:</div><div class="pull-right user-identity"><img class="avatar" src="" alt="" width="40" height="40"><i class="provider icon16-identity-email"></i></div><div class="identity disabled"></div><p class="verify-before">Confirm sending verification to your mailbox?</p><p class="verify-after hide">Verification sent, it should arrive in minutes. Please check your mailbox and follow the instruction.</p><div class="xalert-error hide"><span class="xalert-fail">Requested too much, hold on awhile.</span><br />Receive no verification email? It might be mistakenly filtered as spam, please check and un-spam. Alternatively, use ‘Manual Verification’.</div>',footer:'<button class="pull-right xbtn-blue xbtn-verify">Verify</button><a class="pull-right xbtn-cancel">Cancel</a>'},onShowBefore:function(e){var t=r(e.currentTarget),n=t.data("identity-id")||t.parents("li").data("identity-id"),s=a.get("user"),o=i.filter(s.identities,function(e,t){if(e.id===n)return!0})[0];this.$(".xbtn-verify").data("identity_id",o.id),this.$(".identity").text(o.external_id),this.$(".avatar").attr("src",o.avatar_filename)}}},c.verification_twitter={options:{events:{"click .xbtn-verify":function(e){var t=r(e.currentTarget),n=this;if(t.hasClass("disabled")||t.hasClass("success")){t.hasClass("success")&&this.hide();return}var i=t.data("identity_id"),s=a.get("authorization"),u=s.token;o.request("verifyUserIdentity",{type:"POST",params:{token:u},data:{identity_id:i},beforeSend:function(e){t.addClass("disabled")},complete:function(){t.removeClass("disabled")}},function(e){e.action==="VERIFYING"&&t.text("Done").addClass("success")},function(e){})},"click .xbtn-cancel":function(e){var t=this.element;this.offSrcNode(),this.destory(),t.remove()}},backdrop:!1,viewData:{cls:"mblack modal-ve",title:"Verification",body:'<div class="shadow title">Identity Verification</div><div>Identity to verify:</div><div class="pull-right user-identity"><img class="avatar" src="" alt="" width="40" height="40"><i class="provider icon16-identity-twitter"></i></div><div class="identity disabled"></div><p>You will be directed to Twitter website to authorize <span class="x-sign">EXFE</span>. Don’t forget to follow @<span class="">EXFE</span>, it’s necessary for smooth service integration.</p><p>We hate spam, will NEVER disappoint your trust.</p>',footer:'<button class="pull-right xbtn-blue xbtn-verify">Verify</button><a class="pull-right xbtn-cancel">Cancel</a>'},onShowBefore:function(e){var t=r(e.currentTarget),n=t.parents("li").data("identity-id"),s=a.get("user"),o=i.filter(s.identities,function(e,t){if(e.id===n)return!0})[0];this.$(".xbtn-verify").data("identity_id",o.id),this.$(".identity").text(o.external_id),this.$(".avatar").attr("src",o.avatar_filename)}}},c.verification_phone={options:{events:{},backdrop:!1,viewData:{cls:"mblack modal-ve",title:"Verification",body:'<div class="shadow title">Identity Verification</div><div>Identity to verify:</div>'}}},c.setpassword={options:{onHideAfter:function(){var e=this.element;this.offSrcNode(),this.destory(),e.remove()},events:{"click .password-eye":function(e){var t=r(e.currentTarget),n=t.prev();n.prop("type",function(e,t){return t==="password"?"text":"password"}),t.toggleClass("icon16-pass-hide icon16-pass-show")},"click .xbtn-success":function(e){var t=this,n=t.$("#stpwd").val(),i=t.options.srcNode;if(!n){n||alert("Please set EXFE password.");return}e.preventDefault();var s=r(e.currentTarget),u=a.get("authorization"),f=u.user_id,l=u.token;o.request("setPassword",{type:"POST",params:{token:l},resources:{user_id:f},data:{new_password:n},beforeSend:function(e){s.addClass("disabled loading")},complete:function(e){s.removeClass("disabled loading")}},function(e){var n=a.get("user");n.password=!0,a.set("user",n),i.data("dialog",null).data("dialog-type","changepassword").find("span").text("Change Password..."),r(".set-up").remove(),t.hide()},function(e){if(e.meta.code===403){var t=e.meta.errorType;t==="invalid_current_password"&&alert("Invalid current password.")}})}},backdrop:!1,viewData:{cls:"mblack modal-sp",title:"Set Password",body:'<div class="shadow title">Set Password</div><form class="modal-form"><fieldset><legend>Please set <span class="x-sign">EXFE</span> password of your account.<br />All your identities share the same password for sign-in and account management.</legend><div class="identity"><img class="avatar" src="" width="40" height="40" /><span></span></div><div class="control-group"><label class="control-label" for="stpwd">Password:</label><div class="controls"><input class="input-large" id="stpwd" placeholder="Set EXFE password" type="password" autocomplete="off" /><i class="help-inline password-eye icon16-pass-hide pointer"></i></div></div></fieldset></form>',footer:'<button class="pull-right xbtn-blue xbtn-success">Done</button>'},onShowBefore:function(){var e=a.get("user");this.$(".identity > img").attr("src",e.avatar_filename),this.$(".identity > span").text(e.name)}}},c.setup_email={options:{onHideAfter:function(){var e=this.element;this.offSrcNode(),this.destory(),e.remove()},events:{"blur #name":function(e){var t=u.trim(r(e.currentTarget).val()),n=this.$('[for="name"]'),i=n.find("span");t?u.utf8length(t)>30?(i.text("Too long."),n.addClass("label-error")):u.zh_CN.test(t)?(n.addClass("label-error"),i.text("Invalid character.")):(n.removeClass("label-error"),i.text("")):(n.addClass("label-error"),i.text(""))},"blur #password":function(e){var t=u.trim(r(e.currentTarget).val()),n=this.$('[for="password"]'),i=n.find("span");t?(n.removeClass("label-error"),i.text("")):(n.addClass("label-error"),i.text("Password incorrect."))},"click #password-eye":function(e){var t=r(e.currentTarget),n=t.prev();n.prop("type",function(e,t){return t==="password"?"text":"password"}),t.toggleClass("icon16-pass-hide icon16-pass-show")},"click .xbtn-success":function(e){var t=this,n=this._tokenType==="user",i=n?"resetPassword":"setupUserByInvitationToken",u={};u.name=r.trim(this.$("#name").blur().val()),u.password=this.$("#password").blur().val(),n?u.token=this._originToken:u.invitation_token=this._originToken;if(this.$('[for="name"]').hasClass("label-error")&&this.$('[for="password"]').hasClass("label-error"))return;o.request(i,{type:"POST",data:u},function(e){t.hide();var n=e.authorization;s.emit("app:user:signin:after",function(){window.location.href="/"}),s.emit("app:user:signin",n.token,n.user_id)})}},backdrop:!1,viewData:{cls:"mblack modal-su",title:"Set Up Account",body:'<div class="shadow title">Welcome to <span class="x-sign">EXFE</span></div><form class="modal-form"><fieldset><legend>You’re browsing as identity underneath, please set up your account for easier further use. Got existing account already? <span class="underline">Sign in</span> directly to add this identity.</legend><div class="clearfix control-group"><div class="pull-right user-identity"><img class="avatar" src="" alt="" width="40" height="40" /><i class="provider"></i></div><div class="identity disabled"></div></div><div class="control-group"><label class="control-label" for="name">Display name: <span></span></label><div class="controls"><input type="text" class="input-large" id="name" autocomplete="off" placeholder="Desired recognizable name" /></div></div><div class="control-group"><label class="control-label" for="password">Password: <span></span></label><div class="controls"><input type="password" class="input-large" id="password" autocomplete="off" placeholder="Set EXFE password" /><i class="help-inline icon16-pass-hide pointer" id="password-eye"></i></div></div></fieldset></form>',footer:'<button class="xbtn-white xbtn-siea" data-widget="dialog" data-dialog-type="identification" data-dialog-tab="d00">Sign In and Add…</button><button class="pull-right xbtn-blue xbtn-success">Done</button><a class="pull-right xbtn-discard" data-dismiss="dialog">Discard</a>'},onShowBefore:function(e){var t=r(e.currentTarget).data("source");if(!t)return;var n=t.identity;this._tokenType=t.tokenType,this._originToken=t.originToken,this.$(".identity").text(u.printExtUserName(n)),this.$(".avatar").attr("src",n.avatar_filename).next().addClass("icon16-identity-"+n.provider),this.$(".xbtn-siea").data("source",u.printExtUserName(n))}}},c.setup_twitter={options:{onHideAfter:function(){this._oauth_&&this._oauth_.abort();var e=this.element;this.offSrcNode(),this.destory(),e.remove()},events:{"click .authorize":function(e){this._oauth_=r.ajax({url:"/OAuth/twitterAuthenticate",dataType:"JSON",beforeSend:function(e){},success:function(e){var t=e.meta.code;t===200&&(window.location.href=e.response.redirect)}})}},backdrop:!1,viewData:{cls:"mblack modal-su",title:"Set Up Account",body:'<div class="shadow title">Welcome to <span class="x-sign">EXFE</span></div><form class="modal-form"><fieldset><legend>You’re browsing as identity underneath, please authorize through Twitter to set up your <span class="x-sign">EXFE</span> account.</legend><div class="clearfix control-group"><div class="pull-right user-identity"><img class="avatar" src="" alt="" width="40" height="40" /><i class="provider"></i></div><div class="identity disabled"></div></div><div class="clearfix"><button class="pull-right xbtn-blue authorize">Authorize</button><a class="pull-right underline pointer cancel" data-dismiss="dialog">Cancel</a></div><div class="spliterline"></div><div>Got existing <span class="x-sign">EXFE</span> account already?<br /> Just <span class="underline">sign in to add</span> this identity into your account.</div></fieldset></form>',footer:'<button class="pull-right xbtn-white xbtn-siea" data-widget="dialog" data-dialog-type="identification" data-dialog-tab="d00">Sign In and Add…</button>'},onShowBefore:function(e){var t=r(e.currentTarget).data("source");if(!t)return;var n=t.identity;this._tokenType=t.tokenType,this._originToken=t.originToken,this.$(".identity").text(u.printExtUserName(n)),this.$(".avatar").attr("src",n.avatar_filename).next().addClass("icon16-identity-"+n.provider),this.$(".xbtn-siea").data("source",u.printExtUserName(n))}}},c.browsing_identity={options:{onHideAfter:function(){var e=this.element;this.offSrcNode(),this.destory(),e.remove()},events:{"click .xbtn-go":function(e){window.location.href="/"}},backdrop:!1,viewData:{cls:"mblack modal-bi",title:"Browsing Identity",body:'<div class="shadow title">Browsing Identity</div><div class="user hide"><div>You will be redirected to the link as your currently signed in account underneath:</div><div class="identity"><img class="avatar" src="" width="40" height="40" /><span></span></div><div class="clearfix"><button class="pull-right xbtn-white xbtn-go">Go</button></div><div class="spliterline"></div></div><div class="browsing-tips">You’re currently browsing this page as identity underneath, please choose an option to continue.</div><div class="pull-right user-identity browsing-identity"><img class="avatar" src="" alt="" width="40" height="40"><i class="provider"></i></div><div class="identity disabled bidentity"></div>',footer:'<button class="pull-right xbtn-white xbtn-sias hide" data-widget="dialog" data-dialog-type="identification" data-dialog-tab="d00">Sign in and switch</button><button class="pull-right xbtn-white xbtn-sui hide" data-widget="dialog" data-dialog-type="setup_email">Set up identity</button>'},onShowBefore:function(e){var t=r(e.currentTarget).data("settings");if(!t)return;var n=t.normal,i=t.browsing,s=t.setup,o=t.action;this._user=n,this._browsing_user=i,this._setup=s,this._action=o,this._tokenType=t.tokenType,this._user&&this.$(".user").removeClass("hide").find("img").attr("src",n.avatar_filename).next().text(n.name||n.nickname);var a=u.printExtUserName(i.default_identity);this.$(".browsing-identity").next().text(a).end().find("img").attr("src",i.default_identity.avatar_filename).next().addClass("icon16-identity-"+i.default_identity.provider),this._setup?this.$(".xbtn-sui").removeClass("hide").attr("data-dialog-type","setup_"+i.default_identity.provider).data("source",{identity:i.default_identity,originToken:t.originToken,tokenType:t.tokenType}):this.$(".xbtn-sias").removeClass("hide").data("source",a)}}},c.read_only={options:{onHideAfter:function(){var e=this.element;this.offSrcNode(),this.destory(),e.remove()},backdrop:!1,viewData:{cls:"mblack modal-ro",title:"Read-only Browsing",body:'<div class="shadow title">Read-only Browsing</div><form class="modal-form"><fieldset><legend>You’re browsing this page in read-only mode as <span></span> underneath. To change anything on this page, please <span class="underline">sign in</span> first.</legend><div class="user hide"><div class="identity"><img class="avatar" src="" width="40" height="40" /><span></span></div></div><div class="clearfix control-group browsing-identity hide"><div class="pull-right user-identity"><img class="avatar" src="" alt="" width="40" height="40" /><i class="provider"></i></div><div class="identity disabled"></div></div></fieldset></form>',footer:'<button class="pull-right xbtn-blue" data-widget="dialog" data-dialog-type="identification" data-dialog-tab="d00">Sign In...</button><a class="pull-right xbtn-discard" data-dismiss="dialog">Cancel</a>'},onShowBefore:function(e){var t=r(e.currentTarget).data("settings");if(!t)return;var n=t.isBrowsing,i=u.printExtUserName(t.default_identity);this.$("legend span").eq(0).text(n?"identity":"user"),this.$(".xbtn-blue").data("source",i);if(n){var s=this.$(".browsing-identity").removeClass("hide");s.find(".identity").text(i),s.find(".avatar").attr("src",t.default_identity.avatar_filename),s.find(".provider").addClass("icon16-identity-"+t.default_identity.provider)}else{var o=this.$(".user").removeClass("hide");o.find("span").text(t.name),o.find(".avatar").attr("src",t.avatar_filename)}}}},c.revoked={options:{onHideAfter:function(){var e=this.element;this.offSrcNode(),this.destory(),e.remove()},backdrop:!1,viewData:{cls:"mblack modal-re",title:"Revoked Identity",body:'<div class="shadow title">Revoked Identity</div>'}}};var h=l.extend({availability:!1,init:function(){var e=this;s.off("widget-dialog-identification-auto"),s.on("widget-dialog-identification-auto",function(t){var n=e.$('[for="identity"]'),r=n.find("span"),i=e.$('[for="password"]'),s=i.find("span");e.availability=!1,e.identityFlag=null;var o;e.switchTabType==="d24"&&(o="d01"),e.$(".help-subject").removeClass("icon14-question").addClass("icon14-clear").parent().find(".xalert-error").addClass("hide"),t?(n.removeClass("label-error"),r.text(""),t.identity?(e._identity=t.identity,e.$(".user-identity").removeClass("hide").find(".avatar").attr("src",t.identity.avatar_filename).next().attr("class","provider icon16-identity-"+t.identity.provider)):(e._identity=null,e.$(".user-identity").addClass("hide")),e.identityFlag=t.registration_flag,t.registration_flag==="SIGN_IN"?(o="d01",e.$(".xbtn-forgotpwd").removeClass("hide"),i.removeClass("label-error"),s.text("")):t.registration_flag==="SIGN_UP"?(o="d02",i.removeClass("label-error"),s.text("")):t.registration_flag==="AUTHENTICATE"?(o="d00",e.$(".help-subject").removeClass("icon14-question").addClass("icon14-clear"),e.$(".authenticate").removeClass("hide")):t.registration_flag==="VERIFY"&&(o="d04"),e.availability=!0):e.$(".help-subject").removeClass("icon14-clear").addClass("icon14-question"),o&&e.switchTabType!==o&&e.switchTab(o),e.$(".x-signin")[(e.availability?"remove":"add")+"Class"]("disabled"),e.$(".xbtn-forgotpwd").data("source",t?[t.identity]:t)}),s.off("widget-dialog-identification-nothing"),s.on("widget-dialog-identification-nothing",function(){e.$(".authenticate").addClass("hide"),e.$(".user-identity").addClass("hide"),e.$('[for="identity"]').removeClass("label-error").find("span").text(""),e.$(".xbtn-forgotpwd").addClass("hide").data("source",null),e.availability=!1,e.$(".x-signin")[(e.availability?"remove":"add")+"Class"]("disabled")})},resetInputs:function(){this.$("input").val(""),this.$(".label-error").removeClass("label-error").find("span").text(""),this.$(".icon16-pass-show").toggleClass("icon16-pass-show icon16-pass-hide").prev().prop("type","password"),this.$("#identity").focusend()},setPasswordPlaceHolder:function(e){e==="d02"?this.$("#password").attr("placeholder","Set your EXFE Password"):e==="d01"&&this.$("#password").attr("placeholder","Your EXFE Password")},getFormData:function(e){var t=u.trim(this.$("#identity").val()),n=u.parseId(t);if(e==="d01"||e==="d02")n.password=this.$("#password").val();return e==="d01"&&(n.auto_signin=this.$("#auto-signin").prop("checked")),e==="d02"&&(n.name=u.trim(this.$("#name").val())),n},switchTab:function(e,t){this.$(".d").not(".hide").addClass("hide").end().filter("."+e).removeClass("hide"),this.$(".x-signin")[(this.availability?"remove":"add")+"Class"]("disabled"),this.$(".xalert-error").addClass("hide"),this.switchTabType=e;if(this.isShown&&(this.switchTabType==="d00"||this.switchTabType==="d01"||this.switchTabType==="d02")){var n=this.$("#identity");n.focusend()}this.setPasswordPlaceHolder(e)}});t.Identification=h});