define("lightsaber",function(e,t,n){function c(){var e=new h;return S(e,r.prototype),e.request=new p,e.response=new d,e.init(),e}function h(){}function p(){this.method="GET",this.updateUrl()}function d(e,t){this.path=e,this.title=document.title,this.state=t||{}}function v(e){e=e||{};var t=this;this.map=[],this.params={},this._params=[],this.caseSensitive=e.caseSensitive,this.strict=e.strict,this.middleware=function(n,r,i){t._dispatch(n,r,i)}}function m(e,t,n){n=n||{},this.path=e,this.callbacks=t,this.regexp=T(e,this.keys=[],n.sensitive,n.strict)}function g(e,t,n){t=t||{},this.name=e,this.root=t.root,this.engine=t.engine,this.ext=w(e),this.timestamp=n||"",this.path=this.lookup(e)}function y(e){return function(n,r,i){n.app=r.app=e,n.next=i,i()}}function b(e,t,n,r,s){return i.get(t,function(t){var i,o=t;s!=="html"&&(i=e.compile(t),o=i(n)),r(o)})}function w(e){return e.split(".")[1]||"html"}function E(e){function t(e){for(var n in e)t[n]=e[n];return e}return e.viewCallbacks=e.viewCallbacks||[],t}function S(e,t){var n;if(e&&t)for(n in t)e[n]=t[n];return e}function T(e,t,n,r){return e instanceof RegExp?e:(Array.isArray(e)&&(e="("+e.join("|")+")"),e=e.concat(r?"":"/?").replace(/\/\(/g,"(?:/").replace(/(\/)?(\.)?:(\w+)(?:(\(.*?\)))?(\?)?(\*)?/g,function(e,n,r,i,s,o,u){return t.push({name:i,optional:!!o}),n=n||"",""+(o?"":n)+"(?:"+(o?n:"")+(r||"")+(s||r&&"([^/.]+?)"||"([^/]+?)")+")"+(o||"")+(u?"(/*)?":"")}).replace(/([\/.])/g,"\\$1").replace(/\*/g,"(.*)"),new RegExp("^"+e+"$",n?"":"i"))}var r=e("emitter"),i=e("jquery"),s=window,o=s.location,u=s.history,a="/",f=!1;i(s).on("load",function(e){f=!0,setTimeout(function(){f=!1},0)}),t=n.exports=c,t.createApplication=c;var l;t.version="0.0.1",l=h.prototype,l.historySupport=(u!==null?u.pushState:void 0)!==null,l.init=function(){this.route=a,this.stack=[],this.cache={},this.settings={},this.viewCallbacks=[],this.defaultConfiguration()},l.defaultConfiguration=function(){this.set("env","development"),this.enable("dispatch"),this.use(y(this)),this._usedRouter=!1,this._router=new v(this),this._router.caseSensitive=this.enabled("case sensitive routing"),this._router.strict=this.enabled("strict routing"),this.locals=E(this),this.locals.settings=this.settings,this.configure("development",function(){this.set("env","development odof.com")}),this.configure("production",function(){this.enable("view cache")})},l.use=function(e,t){var n,r,i;return"string"!=typeof e&&(t=e,e=a),a!==e&&a===e[e.length-1]&&(e=e.slice(0,-1)),this.stack.push({route:e,handle:t}),this},l.set=function(e,t){if(1!==arguments.length)return this.settings[e]=t,this;if(this.settings.hasOwnProperty(e))return this.settings[e]},l.enabled=function(e){return!!this.set(e)},l.disabled=function(e){return!this.set(e)},l.enable=function(e){return this.set(e,!0)},l.disable=function(e){return this.set(e,!1)},l.configure=function(e,t){var n="all",r=[].slice.call(arguments);return t=r.pop(),r.length&&(n=r),("all"===n||~n.indexOf(this.settings.env))&&t.call(this),this},l.render=function(e,t,n){var r=this,i={},s=this.cache,o=this.engine,u;"function"==typeof t&&(n=t,t={}),S(i,this.locals),t.locals&&S(i,t.locals),S(i,t),i.cache=null===i.cache?this.enabled("view cache"):i.cache,i.cache&&(u=s[e]);if(!u){u=new g(e,{engine:this.set("view engine"),root:this.set("views")},this.set("timestamp"));if(!u.path){var a=new Error('Failed to lookup view "'+e+'"');return a.view=u,n(a)}i.cache&&(s[e]=u)}console.dir(u);try{u.render(i,n)}catch(a){n(a)}},l.path=function(){return this.route},l.param=function(e,t){var n=[].slice.call(arguments,1),r=0,i;if(x(e))for(i=e.length;r<i;++r)for(var s=0,o=n.length;s<o;++s)this.param(e[r],n[s]);else if("function"==typeof e)this._router.param(e);else{":"===e[0]&&(e=e.substr(1));for(i=n.length;r<i;++r)this._router.param(e,t)}return this},l.get=function(e){var t=[].slice.call(arguments);return this._usedRouter||(this._usedRouter=!0,this.use(this._router.middleware)),this._router.route.apply(this._router,t)},l.handle=function(e,t){function i(s){var o=n[r++],u;if(!o)return;try{u=e.url;if(0!==u.indexOf(o.route))return i(s);var a=o.handle.length;s?4===a?o.handle(s,e,t,i):i(s):4>a?o.handle(e,t,i):i()}catch(f){i(f)}}var n=this.stack,r=0;i()},l.run=function(e){e=e||{};var t=this.request,n=this.response;if(this.running)return;this.running=!0,!1===e.dispatch&&this.disable("dispatch"),!1!==e.popstate&&(this.historySupport?i(s).on("popstate",{app:this},this.change):i(s).on("hashchange",{app:this},this.change));if(this.disabled("dispatch"))return;this.handle(t,n)},l.change=function(e){if(f)return f=!1;var t=e.data.app,n=t.request,r=t.response,i=n.url;n.updateUrl();if("/"!==i&&i===n.url)return;return t.handle(n,r),e.stopPropagation(),e.preventDefault(),!1},l=p.prototype,l.updateUrl=function(){this.host=o.hostname,this.port=o.port||80,this.path=o.pathname,this.hash=o.hash,this.querystring=o.search,this.url=o.pathname+this.querystring+this.hash},l.param=function(e,t){var n=this.params||{},r=this.query||{};return null!=n[e]&&n.hasOwnProperty(e)?n[e]:null!=r[e]?r[e]:t},l.getPath=function(){return this.path},l.getHost=function(){return this.host},l=d.prototype,l.redirect=function(e){var t=argumens.length,n,r;if(1===t){e=arguments[0],(e==="back"||e==="forward")&&u[e]();return}this.path=e,this.title=n,document.title=this.title,this.state=r,this.pushState(),i(s).triggerHandler("popstate")},l.save=function(){u.replaceState(this.state,this.title,this.path)},l.pushState=function(){u.pushState(this.state,this.title,this.path)},l.render=function(e,t,n){var r=this,t=t||{},i=this.app,s=i.request;"function"==typeof t&&(n=t,t={}),t.locals=r.locals,i.render(e,t,n)},l=v.prototype,l.param=function(e,t){if("function"==typeof e){this._params.push(e);return}var n=this._params,r=n.length,i,s;for(s=0;s<r;++s)if(i=n[s](e,t))t=i;if("function"!=typeof t)throw new Error("invalid param() call for "+e+", got "+t);return(this.params[e]=this.params[e]||[]).push(t),this},l._dispatch=function(e,t,n){var r=this.params,i=this;(function s(o,u){function v(t){s(e._route_index+1,t)}function m(t){f=0,p=h[o++],l=p&&e.params[p.name],a=p&&r[p.name];try{"route"===t?v():t?(o=0,y(t)):a&&undefined!==l?g():p?m():(o=0,y())}catch(t){m(t)}}function g(n){var r=a[f++];if(n||!r)return m(n);r(e,t,g,l,p.name)}function y(n){var r=c.callbacks[o++];try{if("route"===n)v();else if(n&&r){if(4>r.length)return y(n);r(n,e,t,y)}else r?r(e,t,y):v(n)}catch(n){y(n)}}var a,f=0,l,c,h,p,d;e.route=c=i.matchRequest(e,o);if(!c)return n(u);e.params=c.params,h=c.keys,o=0,m(u)})(0)},l.matchRequest=function(e,t){var n=e.url,r=this.map,i=r.length,s;t=t||0;for(;t<i;++t){s=r[t];if(s.match(n))return e._route_index=t,s}},l.route=function(e){e||new Error("Router#get() requires a path");var t=[].slice.call(arguments,1),n=new m(e,t,{sensitive:this.caseSensitive,strict:this.strict});return(this.map=this.map||[]).push(n),this},l=m.prototype,l.match=function(e){this.regexp.lastIndex=0;var t=this.keys,n=this.params=[],r=this.regexp.exec(e),i,s,o,u;if(!r)return!1;for(i=1,s=r.length;i<s;++i)o=t[i-1],u="string"==typeof r[i]?decodeURIComponent(r[i]):r[i],o?n[o.name]=u:n.push(u);return!0},l=g.prototype,l.lookup=function(e){return this.root+"/"+e+"?t="+this.timestamp},l.render=function(e,t){return b(this.engine,this.path,e,t,this.ext)};var x=Array.isArray;x||(x=function(e){return e instanceof Array})});