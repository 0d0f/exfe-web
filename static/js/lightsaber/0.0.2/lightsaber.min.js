define("lightsaber",function(e,t,n){function h(){var e=new p;return C(e,r.prototype),e.request=new d,e.response=new v,e.init(),e}function p(){}function d(){this.session={},this.method="GET",this.updateUrl()}function v(e,t){this.path=e,this.title=document.title,this.state=t||{}}function g(e){e=e||{};var t=this;this.map=[],this.params={},this._params=[],this.caseSensitive=e.caseSensitive,this.strict=e.strict,this.middleware=function(n,r,i){t._dispatch(n,r,i)}}function y(e,t,n){n=n||{},this.path=e,this.callbacks=t,this.regexp=L(e,this.keys=[],n.sensitive,n.strict)}function b(e,t,n){t=t||{},this.name=e,this.root=t.root,this.engine=t.engine,this.ext=T(e),this.timestamp=n||"",this.path=this.lookup(e)}function w(e){return function(n,r,i){n.app=r.app=e,n.next=i,r.locals=r.locals||N(r),i()}}function E(){return++E.id}function S(e,t,n){var r=e.length;if(!r)return-1;n||(n=0);if(n>r)return-1;n<0&&(n=Math.max(0,r+n));for(;n<r;++n)if(n in e&&e[n]===t)return n;return-1}function x(e,t,n,r,s){return i.get(t,function(t){var i,o=t;s!=="html"&&(i=e.compile(t),o=i(n)),r(o)})}function T(e){return e.split(".")[1]||"html"}function N(e){function t(e){for(var n in e)t[n]=e[n];return e}return e.viewCallbacks=e.viewCallbacks||[],t}function C(e,t){var n;if(e&&t)for(n in t)e[n]=t[n];return e}function L(e,t,n,r){return e instanceof RegExp?e:(k(e)&&(e="("+e.join("|")+")"),e=e.concat(r?"":"/?").replace(/\/\(/g,"(?:/").replace(/(\/)?(\.)?:(\w+)(?:(\(.*?\)))?(\?)?(\*)?/g,function(e,n,r,i,s,o,u){return t.push({name:i,optional:!!o}),n=n||"",""+(o?"":n)+"(?:"+(o?n:"")+(r||"")+(s||r&&"([^/.]+?)"||"([^/]+?)")+")"+(o||"")+(u?"(/*)?":"")}).replace(/([\/.])/g,"\\$1").replace(/\*/g,"(.*)"),new RegExp("^"+e+"$",n?"":"i"))}var r=e("emitter"),i=e("jquery"),s=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e,t){window.setTimeout(e,1e3/60)}}(),o=window,u=o.location,a=o.history,f="/",l=!1;i(o).on("load",function(e){l=!0,s(function(){l=!1},0)}),t=n.exports=h;var c;t.version="0.0.2",c=p.prototype,c.historySupport=(a!==null?a.pushState:void 0)!==null,i.browser.opera&&(c.historySupport=!1),c.init=function(){this.route=f,this.stack=[],this.cache={},this.settings={},this.engines={},this.viewCallbacks=[],this.defaultConfiguration()},c.defaultConfiguration=function(){this.set("env","production"),this.enable("dispatch"),this.use(w(this)),this._usedRouter=!1,this._router=new g(this),this.routes=this._router.map,this._router.caseSensitive=this.enabled("case sensitive routing"),this._router.strict=this.enabled("strict routing"),this.locals=N(this),this.locals.settings=this.settings,this.configure("development",function(){this.set("env","development")}),this.configure("production",function(){this.enable("view cache")})},c.use=function(e,t){return"string"!=typeof e&&(t=e,e=f),f!==e&&f===e[e.length-1]&&(e=e.slice(0,-1)),this.stack.push({route:e,handle:t}),this},c.engine=function(e,t){if("function"!=typeof t)throw new Error("callback function required");return"."!==e[0]&&(e="."+e),this.engines[e]=t,this},c.set=function(e,t){if(1!==arguments.length)return this.settings[e]=t,this;if(this.settings.hasOwnProperty(e))return this.settings[e]},c.enabled=function(e){return!!this.set(e)},c.disabled=function(e){return!this.set(e)},c.enable=function(e){return this.set(e,!0)},c.disable=function(e){return this.set(e,!1)},c.configure=function(e,t){var n="all",r=[].slice.call(arguments);return t=r.pop(),r.length&&(n=r),("all"===n||~S(n,this.settings.env))&&t.call(this),this},c.render=function(e,t,n){var r=this,i={},s=this.cache,o=this.engine,u;"function"==typeof t&&(n=t,t={}),C(i,this.locals),t.locals&&C(i,t.locals),C(i,t),i.cache=null===i.cache?this.enabled("view cache"):i.cache,i.cache&&(u=s[e]);if(!u){u=new b(e,{engine:this.set("view engine"),root:this.set("views")},this.set("timestamp"));if(!u.path){var a=new Error('Failed to lookup view "'+e+'"');return a.view=u,n(a)}i.cache&&(s[e]=u)}try{u.render(i,n)}catch(a){n(a)}},c.path=function(){return this.route},c.param=function(e,t){var n=[].slice.call(arguments,1),r=0,i;if(k(e))for(i=e.length;r<i;++r)for(var s=0,o=n.length;s<o;++s)this.param(e[r],n[s]);else if("function"==typeof e)this._router.param(e);else{":"===e[0]&&(e=e.substr(1));for(i=n.length;r<i;++r)this._router.param(e,t)}return this},c.initRouter=function(){this._usedRouter===!1&&(this._usedRouter=!0,this.use(this._router.middleware))},c.get=function(e){var t=[].slice.call(arguments);return this.initRouter(),this._router.route.apply(this._router,t)},c.handle=function(e,t,n){function u(n){var a=r[o++],f;s&&(e.url=e.url.substr(1),s=!1),e.url=i+e.url;if(!a)return;try{f=e.url;if(0!==f.indexOf(a.route))return u(n);var l=a.handle.length;i=a.route,e.url=e.url.substr(i.length),"/"!==e.url[0]&&(e.url="/"+e.url,s=!0),n?4===l?a.handle(n,e,t,u):u(n):4>l?a.handle(e,t,u):u()}catch(c){u(c)}}var r=this.stack,i="",s=!1,o=0;u()},c.run=function(e){this.emit("launch"),e=e||{};var t=this.request,n=this.response;if(this.running)return;this.running=!0,!1===e.dispatch&&this.disable("dispatch"),!1!==e.popstate&&(this.historySupport?i(o).on("popstate",{app:this},this.change):i(o).on("hashchange",{app:this},this.change));if(this.disabled("dispatch"))return;this.handle(t,n),this.emit("launched")},c.change=function(e){if(l)return l=!1;var t=e.data.app,n=t.request,r=t.response,i=n.url;n.updateUrl();if("/"!==i&&i===n.url)return;return t.handle(n,r),e.stopPropagation(),e.preventDefault(),delete e.data,!1},c.error=function(e,t){var n=new Error(t);return n.status=e,n},c=d.prototype,c.updateUrl=function(){this.host=u.hostname,this.port=u.port||80,this.path=u.pathname,this.hash=decodeURIComponent(u.hash),this.querystring=decodeURIComponent(u.search),this.url=u.pathname+this.querystring+this.hash},c.param=function(e,t){var n=this.params||{},r=this.query||{};return null!=n[e]&&n.hasOwnProperty(e)?n[e]:null!=r[e]?r[e]:t},c.getPath=function(){return this.path},c.getHost=function(){return this.host},c=v.prototype;var m=i.browser.mozilla?function(e){s(function(){u.href=e},0)}:function(e){s(function(){setTimeout(function(){u.href=e},1e3/60*2)},0)};c.redirect=function(e){var t=arguments.length,n,r;if(1===t){e=arguments[0],e==="back"||e==="forward"?a[e]():m(e);return}n=arguments[1],r=arguments[2]||{},this.path=e,this.title=n,document.title=this.title,this.state=r,this.state.id=E(),this.pushState(),this.historySupport||(u.hash=this.path.substr(2)),i(o).triggerHandler("popstate")},c.save=function(){a.replaceState(this.state,this.title,this.path)},c.pushState=function(){a.pushState(this.state,this.title,this.path)},c.render=function(e,t,n){var r=this,t=t||{},i=this.app,s=i.request;"function"==typeof t&&(n=t,t={}),t.locals=r.locals,i.render(e,t,n)},c=g.prototype,c.param=function(e,t){if("function"==typeof e){this._params.push(e);return}var n=this._params,r=n.length,i,s;for(s=0;s<r;++s)if(i=n[s](e,t))t=i;if("function"!=typeof t)throw new Error("invalid param() call for "+e+", got "+t);return(this.params[e]=this.params[e]||[]).push(t),this},c._dispatch=function(e,t,n){var r=this.params,i=this;(function s(o,u){function v(t){s(e._route_index+1,t)}function m(t){f=0,p=h[o++],l=p&&e.params[p.name],a=p&&r[p.name];try{"route"===t?v():t?(o=0,y(t)):a&&undefined!==l?g():p?m():(o=0,y())}catch(t){m(t)}}function g(n){var r=a[f++];if(n||!r)return m(n);r(e,t,g,l,p.name)}function y(n){var r=c.callbacks[o++];try{if("route"===n)v();else if(n&&r){if(4>r.length)return y(n);r(n,e,t,y)}else r?r(e,t,y):v(n)}catch(n){y(n)}}var a,f=0,l,c,h,p,d;e.route=c=i.matchRequest(e,o);if(!c)return n(u);e.params=c.params,h=c.keys,o=0,m(u)})(0)},c.matchRequest=function(e,t){var n=e.url,r=this.map,i=r.length,s;t=t||0;for(;t<i;++t){s=r[t];if(s.match(n))return e._route_index=t,s}},c.route=function(e){e||new Error("Router#get() requires a path");var t=[].slice.call(arguments,1),n=new y(e,t,{sensitive:this.caseSensitive,strict:this.strict});return(this.map=this.map||[]).push(n),this},c=y.prototype,c.match=function(e){this.regexp.lastIndex=0;var t=this.keys,n=this.params=[],r=this.regexp.exec(e),i,s,o,u;if(!r)return!1;for(i=1,s=r.length;i<s;++i)o=t[i-1],u="string"==typeof r[i]?decodeURIComponent(r[i]):r[i],o?n[o.name]=u:n.push(u);return!0},c=b.prototype,c.lookup=function(e){return this.root+"/"+e+"?t="+this.timestamp},c.render=function(e,t){return x(this.engine,this.path,e,t,this.ext)},E.id=0;var k=Array.isArray;k||(k=function(e){return e instanceof Array})});