define(function(e){function r(e,n,r){e=t(e),r=t.fn.dndsortable.defaults.dragenterData;if(arguments.length===1)return e.data(r)||0;n?e.data(r,Math.max(0,n)):e.data(r,null)}function i(e,n){var r=t(e).next();r[0]===n?t(e).before(n):(t(n).before(e),r.before(n))}function s(e,t,n,r,i){if(r){var s=e.data("drag-timer");s&&(clearTimeout(s),s=null,s=setTimeout(function(){i(t,n)},r),e.data("drag-timer",s))}else i(t,n)}var t=e("jquery"),n=t(document.body);t.fn.dndsortable=function(e){return e=t.extend({},t.fn.dndsortable.defaults,e),this.each(function(){var n=t(this),o,u,a=e.list+e.items,f=n.find(e.items);f.addClass(e.childClass).prop("draggable",!0),n.on("dragstart.ui",a,function(n){return n.stopPropagation(),n.originalEvent.dataTransfer&&(n.originalEvent.dataTransfer.effectAllowed="moving",n.originalEvent.dataTransfer.setData("Text",e.setData(this))),o=t(u=this).addClass(e.draggingClass).index(),e.start&&e.start.call(this,o),!0}).on("dragend.ui",a,function(n){return n.stopPropagation(),t(this).removeClass(e.draggingClass),e.end&&e.end.call(this,o),o=undefined,u=null,r(this,!1),!1}).on("dragenter.ui",a,function(i){if(!u||u===this)return!0;var o=this,a=t(o),f=r(this);return r(this,f+1),f===0&&(a.addClass(e.overClass),e.wrap||s(n,u,this,e.delay,function(n,r){e.enter&&e.enter.call(r),a[t(n).index()<a.index()?"after":"before"](n)})),!1}).on("dragleave.ui",a,function(n){var i=r(this);return r(this,i-1),r(this)||(t(this).removeClass(e.overClass),r(this,!1),e.leave&&e.leave.call(this)),!1}).on("drop.ui",a,function(t){t.stopPropagation(),t.preventDefault();if(this===u)return;return e.wrap&&s(n,u,this,e.delay,function(r,s){e.sort?e.sort.call(n,r,s):i.call(n,r,s);var o;t.originalEvent.dataTransfer&&(o=t.originalEvent.dataTransfer.getData("Text")),e.change&&e.change.call(s,o)}),!1}).on("dragover.ui",a,function(e){return u?(e.stopPropagation(),e.preventDefault(),!1):!0})})},t.fn.dndsortable.defaults={delay:0,wrap:!1,list:"ul",items:"> li",overClass:"sortable-over",placeholderClass:"sortable-placeholder",draggingClass:"sortable-dragging",childClass:"sortable-child",dragenterData:"child-dragenter",setData:function(){}}});