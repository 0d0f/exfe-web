define("filehtml5",[],function(e,t,n){function a(){return"file-"+u++}function f(e,t){return function(r){return e.call(t,r)}}var r=e("class"),i=e("emitter"),s=window,o=r.create(i,{initialize:function(e){var t=null;o.isValidFile(e)?t=e:o.isValidFile(e.file)?t=e.file:t=!1,t&&o.canUpload()&&(this._file=t,this._name=t.name||t.fileName,this._size=t.size||t.fileSize,this._type=t.type,t.hasOwnProperty("lastModifiedDate")&&(this._dateModified=t.lastModifiedDate)),this._id=a()},_uploadEventHandler:function(e){var t=this._xhr,n=e.type;switch(n){case"progress":this.emit("uploadprogress",{originEvent:e,bytesLoaded:e.loaded,bytesTotal:this._size,percentLoaded:Math.min(100,Math.round(1e4*e.loaded/this._size)/100)}),this._bytesUploaded=e.loaded;break;case"load":if(t.status>=200&&t.status<=299){this.emit("uploadcomplete",{originEvent:e,data:e.target.responseText});var r=t.upload,i=this._boundEventHandler;r.removeEventListener("progress",i),r.removeEventListener("crror",i),r.removeEventListener("abort",i),t.removeEventListener("load",i),t.removeEventListener("error",i),t.removeEventListener("readystatechange",i),this._xhr=null}else this.emit("uploaderror",{originEvent:e,status:t.status,statusText:t.statusText,source:"http"});break;case"error":this.emit("uploaderror",{originEvent:e,status:t.status,statusText:t.statusText,source:"FileHTML5"});break;case"abort":this.emit("uploadcancel",{originEvent:e});break;case"readystatechange":this.emit("readystatechange",{originEvent:e,readyState:e.target.readyState})}},startUpload:function(e,t,n){this._bytesUploaded=0,this._xhr=new XMLHttpRequest,this._boundEventHandler=f(this._uploadEventHandler,this);var r=new FormData,i=n,s=this._xhr,o=s.upload,u=this._boundEventHandler,a;for(a in t)typeof t[a]=="Blob"?r.append(a,t[a],a):r.append(a,t[a]);i&&r.append(i,this._file),s.addEventListener("loadstart",u,!1),s.addEventListener("load",u,!1),s.addEventListener("error",u,!1),s.addEventListener("abort",u,!1),s.addEventListener("loadend",u,!1),s.addEventListener("readystatechange",u,!1),o.addEventListener("progress",u,!1),o.addEventListener("error",u,!1),o.addEventListener("abort",u,!1),s.open("POST",e,!0),s.withCredentials=!0;if(this._xhrHeaders)for(a in this._xhrHeaders)s.setRequestHeader(a,this._xhrHeaders[a]);s.send(r),this.emit("uploadstart",{xhr:s})},cancelUpload:function(){this._xhr.abort()}});o.isValidFile=function(e){return s&&s.File&&e instanceof s.File},o.canUpload=function(){return s&&s.FormData&&s.XMLHttpRequest};var u=0;return o});