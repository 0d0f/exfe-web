define(function(e,t,n){var r=e("bus"),i=e("store"),s=e("config"),o=e("odof"),u=e("middleware"),a=o().use(u.login),f=0;r.on("xapp:goto_home",function(e){0===f++&&(a.response.redirect("/","EXFE.COM",{id:"home"}),e&&e(),f=0)});var l=0,c="xapp:goto_profile";r.on(c,function(){if(a.request.url!=="/")return;var e=i.get("last_external_id");a.response.redirect("/#"+e,"Profile",{id:"profile"})}),r.on("xapp:home_profile",function(){a.response.loginable=!0,r.emit(c)}),a.get("/",function(e,t,n){if(t.loginable)return;$("#js-signin").show(),$(document).find("head").eq(0).append('<link rel="stylesheet" type="text/css" href="/static/_css/home.css?t='+s.timestamp+'" />'),$.ajax({url:"/static/views/index.html?t="+s.timestamp,success:function(e){$('.container > div[role="main"]').html(""),$("#home").append(e)}})}),a.get("/#gather",function(e,t,n){$('.container > div[role="main"]').html(""),$("#home").html(""),$.ajax({url:"/static/views/x.html?t="+s.timestamp,success:function(e){$('.container > div[role="main"]').append(e),r.emit("xapp:cross:main"),r.emit("xapp:cross",0),n()}})}),a.get("/#!:id",function(e,t,n){var i=e.params.id;$('.container > div[role="main"]').html(""),$("#home").html(""),$.ajax({url:"/static/views/x.html?t="+s.timestamp,success:function(e){$('.container > div[role="main"]').append(e),r.emit("xapp:cross:main"),r.emit("xapp:cross",+i),n()}})}),a.get(/^\/#!([\w\d]+)\/(@?[\w\d]+)/,function(e,t,n){}),a.get(/^\/#([^@\/\s\!]+)@([^@\/\s\.]+)/,function(e,t,n){$("#home").html(""),$.ajax({url:"/static/views/profile.html?t="+s.timestamp,success:function(e){$('.container > div[role="main"]').empty().append(e),n()}})},function(e,t,n){var s=i.get("user");r.emit("app:signinsuccess",s);var o=$.Deferred(),u=i.get("signin");o.resolve(u),r.emit("app:signinothers",o)}),a.run(),$(document.body).on("click.xapp",'[href^="/#"]',function(e){r.emit("xapp:cross:end");var t=$(e.currentTarget),n=t.attr("href");if(n==="/#gather")a.response.redirect(n,"Gather a X",{id:"gather0"});else if(2===n.indexOf("!"))a.response.redirect(n,"Cross",{id:"cross"+n.substr(2)});else{var s=i.get("last_external_id");a.response.redirect("/#"+s,"Profile",{id:"profile"})}e.stopPropagation(),e.preventDefault()})});