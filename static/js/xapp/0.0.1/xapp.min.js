define(function(e,t,n){var r=e("bus"),i=e("store"),s=e("config"),o=e("odof"),u=e("middleware"),a=e("lightsaber"),f=a();f.use(u.login),f.configure(function(){f.set("views","/static/views")}),f.configure("development",function(){});var l=0;r.on("xapp:goto_home",function(e){0===l++&&(f.response.redirect("/","EXFE.COM",{id:"home"}),e&&e(),l=0)});var c=0,h="xapp:goto_profile";r.on(h,function(){if(f.request.url!=="/")return;var e=i.get("last_external_id");f.response.redirect("/#"+e,"Profile",{id:"profile"})}),r.on("xapp:home_profile",function(){f.response.loginable=!0,r.emit(h)}),f.get("/",function(e,t,n){if(t.loginable)return;$("#js-signin").show(),$(document).find("head").eq(0).append('<link rel="stylesheet" type="text/css" href="/static/_css/home.css?t='+s.timestamp+'" />'),$.ajax({url:"/static/views/index.html?t="+s.timestamp,success:function(e){$('.container > div[role="main"]').html(""),$("#home").append(e)}})}),f.param("crossId",function(e,t,n,r){r!=0?n():n(new Error("crossId fail"))}),f.get("/#!:crossId",function(e,t,n){var i=e.params.crossId;$('.container > div[role="main"]').html(""),$("#home").html(""),$.ajax({url:"/static/views/x.html?t="+s.timestamp,success:function(e){$('.container > div[role="main"]').append(e),r.emit("xapp:cross:main"),r.emit("xapp:cross",+i),n()}})}),f.get("/#gather",function(e,t,n){$('.container > div[role="main"]').html(""),$("#home").html(""),$.ajax({url:"/static/views/x.html?t="+s.timestamp,success:function(e){$('.container > div[role="main"]').append(e),r.emit("xapp:cross:main"),r.emit("xapp:cross",0),n()}})}),f.get(/^\/#([^@\/\s\!]+)@([^@\/\s\.]+)/,function(e,t,n){$("#home").html(""),$.ajax({url:"/static/views/profile.html?t="+s.timestamp,success:function(e){$('.container > div[role="main"]').empty().append(e),n()}})},function(e,t,n){var s=i.get("user");r.emit("app:signinsuccess",s);var o=$.Deferred(),u=i.get("signin");o.resolve(u),r.emit("app:signinothers",o)}),f.run(),$(document.body).on("click.xapp",'[href^="/#"]',function(e){r.emit("xapp:cross:end");var t=$(e.currentTarget),n=t.attr("href");if(n==="/#gather")f.response.redirect(n,"Gather a X",{id:"gather0"});else if(2===n.indexOf("!"))f.response.redirect(n,"Cross",{id:"cross"+n.substr(2)});else{var s=i.get("last_external_id");f.response.redirect("/#"+s,"Profile",{id:"profile"})}e.stopPropagation(),e.preventDefault()})});