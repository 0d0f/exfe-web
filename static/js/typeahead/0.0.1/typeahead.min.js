define("typeahead",[],function(e,t,n){function u(e,t){function n(n){return e.call(t,n)}return e?n:undefined}var r=e("jquery"),i=e("widget"),s=document.body,o=i.extend({options:{source:[],template:'<div class="popmenu hide"></div>',target:null,parentNode:s,viewData:{menu:'<ul class="typeahead"></ul>',item:"<li></li>"}},isShown:!1,init:function(){this.parentNode=this.options.parentNode,this.source=this.options.source,this.element.appendTo(this.parentNode),this.listen()},listen:function(){this.target=this.target||this.options.target,this.target.on("blur.typeahead",u(this.blur,this)).on("keypress.typeahead",u(this.keypress,this)).on("keyup.typeahead",u(this.keyup,this)).on("focus.typeahead",u(this.focus,this)),r.browser.webkit|r.browser.msie|r.browser.mozilla&&this.target.on("keydown.typeahead",u(this.keypress,this)),this.element.on("click.typeahead",u(this.click,this)).on("mouseenter.typeahead","li",u(this.mouseenter,this))},select:function(){var e=this.$(".active"),t=e.attr("data-value");return this.target.val(this.updater(t)).change(),this.emit("select",t),this.hide()},updater:function(e){return e},itemRender:function(e,t){return r(this.options.viewData.item).attr("data-value",e).html(e)},render:function(e){var t=this;e=r(e).map(function(e,n){return t.itemRender(n,e)[0]}),e.first().addClass("active");var n=r(this.options.viewData.menu).html(e);return this.element.html(n),this},show:function(){var e=r.extend({},this.target.offset(),{height:this.target[0].offsetHeight});return this.element.css({top:e.top+e.height,left:e.left}),this.element.removeClass("hide"),this.isShown=!0,this},hide:function(){return this.element.addClass("hide"),this.isShown=!1,this},lookup:function(e){var t=this,n=this.options,i;this.query=r.trim(this.target.val());if(!this.query)return this.emit("nothing"),this.isShown?this.hide():this;this.emit("search",this.query)},next:function(e){var t=this.element.find(".active").removeClass("active"),n=t.next();n.length||(n=this.element.find("li").first()),n.addClass("active")},prev:function(e){var t=this.element.find(".active").removeClass("active"),n=t.prev();n.length||(n=this.element.find("li").last()),n.addClass("active")},focus:function(e){},keyup:function(e,t){t=e.keyCode;switch(t){case 40:case 38:break;case 9:case 13:if(!this.isShown)return;this.select();break;case 27:if(!this.isShown)return;this.hide();break;default:this.lookup()}e.stopPropagation(),e.preventDefault()},keypress:function(e,t){if(!this.isShown)return;t=e.keyCode;switch(t){case 13:case 27:e.preventDefault();break;case 38:if(e.type!=="keydown")break;e.preventDefault(),this.prev();break;case 40:if(e.type!=="keydown")break;e.preventDefault(),this.next()}e.stopPropagation()},blur:function(e){var t=this;setTimeout(function(){t.hide()},150)},click:function(e){e.stopPropagation(),e.preventDefault(),this.select()},mouseenter:function(e){this.element.find(".active").removeClass("active"),r(e.currentTarget).addClass("active")}});return o});