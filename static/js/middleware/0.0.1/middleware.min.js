define("middleware",function(e,t,n){var r=e("api"),i=e("bus"),s=e("store"),o=n.exports={};o.basicAuth=function(e,t,n){if(e.session.checked){n();return}var r,o,u,a,f=document.getElementsByName("signin-token")[0];f&&(a=JSON.parse(f.content),s.set("signin",r=a.signin),document.getElementsByTagName("head")[0].removeChild(f),i.emit("xapp:usertoken",r.token,r.user_id,2),i.emit("xapp:usersignin")),r=r||s.get("signin"),o=r&&r.token||!1,u=r&&r.user_id||!1;if(!o){n();return}e.session.user_id=u,e.session.token=o,e.session.checked=!0,n()}});