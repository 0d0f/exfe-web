define("middleware",function(e,t,n){function u(){var e=document.getElementsByTagName("head")[0],t=document.getElementsByName("authorization")[0],n=null;return t&&(n=JSON.parse(t.content),e.removeChild(t)),n}var r=e("api"),i=e("bus"),s=e("store"),o=n.exports={};o.basicAuth=function(e,t,n){var r=e.session,i=s.get("authorization"),o=s.get("user"),a=u();i&&!a?(r.authorization=i,r.user=o):!i&&a?r.authorization=a:i&&a&&r.authorization.token!==a.token&&r.authorization.user_id!==a.user_id&&s.set("authorization",r.authorization=a),n()},o.errorHandler=function(e,t,n){console.log("error handler")}});