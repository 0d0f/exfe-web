define("middleware",function(e,t,n){var r=e("api"),i=e("bus"),s=e("store"),o=n.exports={};o.basicAuth=function(e,t,n){if(e.session.checked){n();return}var o,u,a,f,l=document.getElementsByName("signin-token")[0];l&&(f=JSON.parse(l.content),s.set("signin",o=f.signin),document.getElementsByTagName("head")[0].removeChild(l),i.emit("xapp:usertoken",o.token,o.user_id,2),i.emit("xapp:usersignin")),o=o||s.get("signin"),u=o&&o.token||!1,a=o&&o.user_id||!1;if(!u){n();return}e.session.user_id=a,e.session.token=u,e.session.checked=!0,r.request("checkAuthorization",{type:"POST",data:{token:u}},function(t){e.session.identities_status=t.identities_status,e.session.password=t.password,n()})}});