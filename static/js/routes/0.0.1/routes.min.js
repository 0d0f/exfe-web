define("routes",function(e,t,n){function u(e){var t=s.get("user"),n=s.get("user").default_identity,r=n.external_username;n.provider==="twitter"&&(r="@"+r),e.redirect("/#"+r)}var r=e("api"),i=e("bus"),s=e("store");e("user");var o=n.exports={};o.switchPage=function(e,t,n){var r=$(document.body),i=$("#js-navbar");$('#js-main > div[role="main"]').empty(),!!e.session.token||e.url!=="/"&&e.url!=="/#"?(r.removeClass("hbg"),i.removeClass("hide")):(r.addClass("hbg"),i.addClass("hide")),n()},o.signin=function(e,t,n){var r=e.session;if(!r.token){var s=$("#js-signin").show().next().hide();s.find(".user-name > span").removeClass("browsing-identity").text(""),s.find(".user-panel").remove();if(e.url!=="/#gather"){t.redirect("/");return}}else $(document).off("click.home"),r.unRegenerate||i.emit("xapp:usertoken",r.token,r.user_id,2),r.unRegenerate&&(r.unRegenerate=!1);n()},o.index=function(e,t,n){if(e.session.token){u(t);return}var r=$('#js-main > div[role="main"]');t.render("index.html",function(e){r.append(e);var t=r.find("div.page-main"),n=$('<img class="exfe-toy" id="js-exfe-toy" src="/static/img/exfe.png" alt="" />');n.load(function(){t.append(n),$.getScript("/static/js/home/0.0.1/home.js")})})},o.gather=function(e,t,n){t.render("x.html",function(e){$('#js-main > div[role="main"]').append(e),i.emit("xapp:cross:main"),i.emit("xapp:cross",0),n()})},o.resolveTokenParam=function(e,t,n,i){i&&i.match(/^[a-zA-Z0-9]{32}$/)?r.request("resolveToken",{type:"POST",data:{token:i}},function(t){t&&t.action==="VERIFIED"?(e.session.token=t.token,e.session.user_id=t.user_id,s.set("signin",{user_id:t.user_id,token:t.token}),n()):t.action==="INPUT_NEW_PASSWORD"},function(e){e.meta.code===400&&t.redirect("/")}):t.redirect("/")},o.resolveToken=function(e,t,n){var r="xapp:logindone";i.on(r,function(e,n){u(t)})},o.profile=function(e,t,n){document.title="Profile",t.render("profile.html",function(e){$('#js-main > div[role="main"]').append(e);var t=s.get("user");i.emit("app:signinsuccess",t);var n=$.Deferred(),r=s.get("signin");n.resolve(r),i.emit("app:signinothers",n)})},o.crossTokenParam=function(e,t,n,o){if(o&&o.match(/^[a-zA-Z0-9]{32}$/)){var u=e.session.token,a={};if(!u){var f=s.get("signin");f&&(u=f.token)}u&&(a.token=u),r.request("getCrossByInvitationToken",{type:"POST",params:a,data:{invitation_token:o}},function(t){var r=t.signin,o=t.browsing_identity,u=t.action,a=t.cross,f=t.read_only;r?(s.set("signin",r),i.emit("xapp:usertoken",r.token,r.user_id,2),e.session.token=r.token,e.session.user_id=r.user_id):o&&(u==="setup"&&(o.isSetup=!0),o.isNotLogin=!e.session.token,i.emit("xapp:crosstoken",o)),e.session.tmpData=t,e.session.unRegenerate=!0,n()})}else t.redirect("/")},o.crossToken=function(e,t,n){var r=e.session.tmpData,s=r.cross,o=r.browsing_identity,u=r.read_only,a=e.params.ctoken;delete e.session.tmpData,t.render("x.html",function(e){$('#js-main > div[role="main"]').append(e),i.emit("xapp:cross:main"),i.emit("xapp:cross",null,o,s,u,a)})},o.crossParam=function(e,t,n,r){!/^0*$/.test(r)&&/^[0-9]+$/.test(r)?(e.params.cross_id=+r,n()):u(t)},o.cross=function(e,t,n){var r=e.params.cross_id;t.render("x.html",function(e){$('#js-main > div[role="main"]').append(e),i.emit("xapp:cross:main"),i.emit("xapp:cross",r)})}});