define("filehtml5",[],function(a,b,c){function i(){return"file-"+h++}function j(a,b){return function(d){return a.call(b,d)}}var d=a("class"),e=a("emitter"),f=window,g=d.create(e,{initialize:function(a){var b=null;g.isValidFile(a)?b=a:g.isValidFile(a.file)?b=a.file:b=!1,b&&g.canUpload()&&(this._file=b,this._name=b.name||b.fileName,this._size=b.size||b.fileSize,this._type=b.type,b.hasOwnProperty("lastModifiedDate")&&(this._dateModified=b.lastModifiedDate)),this._id=i()},_uploadEventHandler:function(a){var b=this._xhr,c=a.type;switch(c){case"progress":this.emit("uploadprogress",{originEvent:a,bytesLoaded:a.loaded,bytesTotal:this._size,percentLoaded:Math.min(100,Math.round(1e4*a.loaded/this.get("size"))/100)}),this._bytesUploaded=a.loaded;break;case"load":if(b.status>=200&&b.status<=299){this.emit("uploadcomplete",{originEvent:a,data:a.target.responseText});var d=b.upload,e=this._boundEventHandler;d.removeEventListener("progress",e),d.removeEventListener("crror",e),d.removeEventListener("abort",e),b.removeEventListener("load",e),b.removeEventListener("error",e),b.removeEventListener("readystatechange",e),this._xhr=null}else this.emit("uploaderror",{originEvent:a,status:b.status,statusText:b.statusText,source:"http"});break;case"error":this.emit("uploaderror",{originEvent:a,status:b.status,statusText:b.statusText,source:"FileHTML5"});break;case"abort":this.emit("uploadcancel",{originEvent:a});break;case"readystatechange":this.emit("readystatechange",{originEvent:a,readyState:a.target.readyState})}},startUpload:function(a,b,c){this._bytesUploaded=0,this._xhr=new XMLHttpRequest,this._boundEventHandler=j(this._uploadEventHandler,this);var d=new FormData,e=c||"Filedata",f=this._xhr,g=f.upload,h=this._boundEventHandler,i;for(i in b)d.append(i,b[i]);d.append(e,this._file),f.addEventListener("loadstart",h,!1),f.addEventListener("load",h,!1),f.addEventListener("error",h,!1),f.addEventListener("abort",h,!1),f.addEventListener("loadend",h,!1),f.addEventListener("readystatechange",h,!1),g.addEventListener("progress",h,!1),g.addEventListener("error",h,!1),g.addEventListener("abort",h,!1),f.open("POST",a,!0),f.withCredentials=!0;if(this._xhrHeaders)for(i in this._xhrHeaders)f.setRequestHeader(i,this._xhrHeaders[i]);f.send(d),this.emit("uploadstart",{xhr:f})},cancelUpload:function(){this._xhr.abort()}});g.isValidFile=function(a){return f&&f.File&&a instanceof f.File},g.canUpload=function(){return f&&f.FormData&&f.XMLHttpRequest};var h=0});