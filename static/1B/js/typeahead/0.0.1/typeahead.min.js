define("typeahead",[],function(a,b,c){function h(a,b){function c(c){return a.call(b,c)}return a?c:undefined}var d=a("jquery"),e=a("widget"),f=document.body,g=e.extend({options:{source:[],template:'<div class="popmenu hide"></div>',target:null,parentNode:f,viewData:{menu:'<ul class="typeahead"></ul>',item:"<li></li>"}},isShown:!1,init:function(){this.parentNode=this.options.parentNode,this.source=this.options.source,this.element.appendTo(this.parentNode),this.listen()},listen:function(){this.target=this.target||this.options.target,this.target.on("blur.typeahead",h(this.blur,this)).on("keypress.typeahead",h(this.keypress,this)).on("keyup.typeahead",h(this.keyup,this)).on("focus.typeahead",h(this.focus,this)),d.browser.webkit|d.browser.msie|d.browser.mozilla&&this.target.on("keydown.typeahead",h(this.keypress,this)),this.element.on("click.typeahead",h(this.click,this)).on("mouseenter.typeahead","li",h(this.mouseenter,this))},select:function(){var a=this.$(".active"),b=a.attr("data-value");return this.target.val(this.updater(b)).change(),this.emit("select",b),this.hide()},updater:function(a){return a},itemRender:function(a,b){return d(this.options.viewData.item).attr("data-value",a).html(a)},render:function(a){var b=this;a=d(a).map(function(a,c){return b.itemRender(c,a)[0]}),a.first().addClass("active");var c=d(this.options.viewData.menu).html(a);return this.element.html(c),this},show:function(){var a=d.extend({},this.target.offset(),{height:this.target[0].offsetHeight});return this.element.css({top:a.top+a.height,left:a.left}),this.element.removeClass("hide"),this.isShown=!0,this},hide:function(){return this.element.addClass("hide"),this.isShown=!1,this},lookup:function(a){var b=this,c=this.options,e;this.query=d.trim(this.target.val());if(!this.query)return this.emit("nothing"),this.isShown?this.hide():this;this.emit("search",this.query)},next:function(a){var b=this.element.find(".active").removeClass("active"),c=b.next();c.length||(c=this.element.find("li").first()),c.addClass("active")},prev:function(a){var b=this.element.find(".active").removeClass("active"),c=b.prev();c.length||(c=this.element.find("li").last()),c.addClass("active")},focus:function(a){},keyup:function(a,b){b=a.keyCode;switch(b){case 40:case 38:break;case 9:case 13:if(!this.isShown)return;this.select();break;case 27:if(!this.isShown)return;this.hide();break;default:this.lookup()}a.stopPropagation(),a.preventDefault()},keypress:function(a,b){if(!this.isShown)return;b=a.keyCode;switch(b){case 13:case 27:a.preventDefault();break;case 38:if(a.type!=="keydown")break;a.preventDefault(),this.prev();break;case 40:if(a.type!=="keydown")break;a.preventDefault(),this.next()}a.stopPropagation()},blur:function(a){var b=this;setTimeout(function(){b.hide()},150)},click:function(a){a.stopPropagation(),a.preventDefault(),this.select()},mouseenter:function(a){this.element.find(".active").removeClass("active"),d(a.currentTarget).addClass("active")}});return g});