部署记录


0 服务器
    lighttpd
    mysql 5
    redis 2.4
    php 5
    monit

    php需要安装 php-redis

//linux
apt-get update
apt-get install build-essential
apt-get install redis
apt-get install redis-server
apt-get install mysql-server
apt-get install libxml2-dev
apt-get install libssl-dev
apt-get install libcurl4-openssl-dev
apt-get install libjpeg62-dev
apt-get install libpng12-dev
apt-get install libmysqlclient-dev
apt-get install libpcre3-dev
apt-get install libbz2-dev
apt-get install libcurl4-gnutls-dev libexpat1-dev gettext libz-dev libssl-dev
apt-get install git-core gitosis
apt-get install autoconf
apt-get install libc-client2007e-dev
wget http://us.php.net/distributions/php-5.3.8.tar.bz2
#'./configure' '--with-mysql' '--enable-mbstring' '--with-curl' '--with-pdo-mysql' '--with-openssl' '--with-gd' '--with-jpeg-dir=/usr/lib' '--disable-fileinfo' '--with-iconv-dir=/usr/local/lib'
'./configure' '--with-mysql' '--enable-mbstring' '--with-curl' '--with-pdo-mysql' '--with-openssl' '--with-gd' '--with-jpeg-dir=/usr/lib' '--disable-fileinfo' '--with-iconv-dir=/usr/local/lib' --with-imap  --with-imap-ssl --with-kerberos
wget http://download.lighttpd.net/lighttpd/releases-1.4.x/lighttpd-1.4.29.tar.gz

git clone https://github.com/nicolasff/phpredis.git

CREATE DATABASE exfe CHARACTER SET utf8 COLLATE utf8_general_ci;
GRANT ALL PRIVILEGES ON exfe.* TO 'exfe'@'localhost' IDENTIFIED BY 'di5#vuaavF' WITH GRANT OPTION;
FLUSH PRIVILEGES;

//freebsd
/usr/ports/textproc/php5-simplexml
/usr/ports/security/php5-hash
/usr/ports/textproc/php5-ctype
/usr/ports/databases/php5-redis
/usr/ports/mail/php5-imap

//icu

    a php增加 --enable-intl 编译，实现先安装icu-project http://www.icu-project.org/

    b config.php 里面增加了 define('INTL_RESOURCES', '/Users/huoju/www/exfe/intl'); 用来定义资源文件所在位置

    c common.php 里面增加了

    $locale=Locale::acceptFromHttp($_SERVER['HTTP_ACCEPT_LANGUAGE']);
    $exfe_res = new ResourceBundle($locale, INTL_RESOURCES);

    用来根据locale载入资源。目前是根据浏览器判断，因为界面上还没有切换语言的位置。但未来应该把这些从common移动到其他地方，因为这个位置还没法读数据库和设置cookie。

    d 在intl目录里面，root.txt和zh.txt是资源文件，root是默认的，用英文，zh是中文。格式一看就明白。在一个table里面中英文字段要对应，不然会有显示成空白的情况，比如 gather 就是一个table，其中字段要一致。现在我是按照一个view文件一个table这样来的。完全不存在的table会自动继承root的资源，反而无所谓。

    e views/x/gatherView.php 是我目前修改了一点的模版

    首先 <?php global $exfe_res;?>  把common里面的全局变量声明了，然后 <?php echo $exfe_res["gather"]["Write_some_words_about_this_X"];?>  这样就是本地化的资源串了。


1 脚本

    发送邮件等的任务脚本。位于script目录
    注意，对于需要组合多个消息发送的任务需要使用 MULTI=true 参数

2 配置文件
config.php.sample
mailclient/mailconf.php.sample


php 配置文件
session.cookie_domain = '.exfe.com'


mysql 配置文件
[mysqld]
default-time-zone='+00:00'




